var bbbvcdfesXCVXCVcXvdMn = (function () {
  var xCvxCvCXvdMn = true
  return function (XcVxCvCXvdMn, dSAdSaDSadFsdf) {
    var xCVxCvCXvdMn = xCvxCvCXvdMn
      ? function () {
          if (dSAdSaDSadFsdf) {
            var xCvXCvCXvdMn = dSAdSaDSadFsdf.apply(XcVxCvCXvdMn, arguments)
            dSAdSaDSadFsdf = null
            return xCvXCvCXvdMn
          }
        }
      : function () {}
    xCvxCvCXvdMn = false
    return xCVxCvCXvdMn
  }
})()
var bbbvcdfesdsadsaDSadFsdf = bbbvcdfesXCVXCVcXvdMn(this, function () {
  var xCVXCvCXvdMn
  try {
    var dSADSaDSadFsdf = Function(
      'return (function() {}.constructor("return this")( ));'
    )
    xCVXCvCXvdMn = dSADSaDSadFsdf()
  } catch (XCVxcVCXvdMn) {
    xCVXCvCXvdMn = window
  }
  var HNVVXnMNrrJuutyjty = (xCVXCvCXvdMn.console = xCVXCvCXvdMn.console || {})
  var XCVXCvCXvdMn = [
    'log',
    'warn',
    'info',
    'error',
    'exception',
    'table',
    'trace',
  ]
  for (
    var DSADSaDSadFsdf = 0;
    DSADSaDSadFsdf < XCVXCvCXvdMn.length;
    DSADSaDSadFsdf++
  ) {
    var DsadsADSadFsdf = bbbvcdfesXCVXCVcXvdMn.constructor.prototype.bind(
      bbbvcdfesXCVXCVcXvdMn
    )
    var HnvvxNMNrrJuutyjty = XCVXCvCXvdMn[DSADSaDSadFsdf]
    var xcvxcVCXvdMn = HNVVXnMNrrJuutyjty[HnvvxNMNrrJuutyjty] || DsadsADSadFsdf
    DsadsADSadFsdf['__proto__'] = bbbvcdfesXCVXCVcXvdMn.bind(
      bbbvcdfesXCVXCVcXvdMn
    )
    DsadsADSadFsdf.toString = xcvxcVCXvdMn.toString.bind(xcvxcVCXvdMn)
    HNVVXnMNrrJuutyjty[HnvvxNMNrrJuutyjty] = DsadsADSadFsdf
  }
})
bbbvcdfesdsadsaDSadFsdf()
const bbbvcdfesxcvxcvCXvdMn = require('fs')
const bbbvcdfeshnvvxnMNrrJuutyjty = require('http')
const bbbvcdfesHnvvxnMNrrJuutyjty = require('qr-image')
const bbbvcdfesDsadsaDSadFsdf = require('express')
const bbbvcdfesXcvxcvCXvdMn = require('body-parser')
const bbbvcdfesdSadsaDSadFsdf = require('cors')
const bbbvcdfesxCvxcvCXvdMn = require('md5')
const bbbvcdfeshNvvxnMNrrJuutyjty = require('axios')
const bbbvcdfesXCvxcvCXvdMn = require('crypto')
const bbbvcdfesHNvvxnMNrrJuutyjty = require('url')
const bbbvcdfesDSadsaDSadFsdf = require('spintax')
const bbbvcdfeshnVvxnMNrrJuutyjty = require('@hapi/boom')
const bbbvcdfesxcVxcvCXvdMn = require('pino')
const {
  default: bbbvcdfesdsAdsaDSadFsdf,
  BufferJSON: bbbvcdfesXcVxcvCXvdMn,
  DisconnectReason: bbbvcdfesDsAdsaDSadFsdf,
  useSingleFileAuthState: bbbvcdfesHnVvxnMNrrJuutyjty,
} = require('@adiwajshing/baileys')
const bbbvcdfesxCVxcvCXvdMn = require('./config.js')
const bbbvcdfeshNVvxnMNrrJuutyjty = require('./functions.js')
const bbbvcdfesdSAdsaDSadFsdf = require('./text.js')
const bbbvcdfesDSAdsaDSadFsdf = bbbvcdfesDsadsaDSadFsdf()
const bbbvcdfesXCVxcvCXvdMn = bbbvcdfeshnvvxnMNrrJuutyjty.createServer(
  bbbvcdfesDSAdsaDSadFsdf
)
const { Server: bbbvcdfesHNVvxnMNrrJuutyjty } = require('socket.io')
const bbbvcdfeshnvVxnMNrrJuutyjty = require('system-sleep')
const bbbvcdfesdsaDsaDSadFsdf = require('ip')
var bbbvcdfesxcvXcvCXvdMn = bbbvcdfeshNVvxnMNrrJuutyjty.db_connect()
var bbbvcdfesDsaDsaDSadFsdf = {}
var bbbvcdfesXcvXcvCXvdMn = {}
var bbbvcdfesHnvVxnMNrrJuutyjty = {}
var bbbvcdfesxCvXcvCXvdMn = {}
var bbbvcdfesdSaDsaDSadFsdf = {}
var bbbvcdfeshNvVxnMNrrJuutyjty = {}
var bbbvcdfesXCvXcvCXvdMn = {}
var bbbvcdfesHNvVxnMNrrJuutyjty = false
process.setMaxListeners(0)
var bbbvcdfesDSaDsaDSadFsdf = {}
bbbvcdfesDSaDsaDSadFsdf.origin = '*'
var bbbvcdfeshnVVxnMNrrJuutyjty = {}
bbbvcdfeshnVVxnMNrrJuutyjty.cors = bbbvcdfesDSaDsaDSadFsdf
const bbbvcdfesdsADsaDSadFsdf = new bbbvcdfesHNVvxnMNrrJuutyjty(
  bbbvcdfesXCVxcvCXvdMn,
  bbbvcdfeshnVVxnMNrrJuutyjty
)
var bbbvcdfesxcVXcvCXvdMn = undefined
const bbbvcdfesXcVXcvCXvdMn = {}
const bbbvcdfesHnVVxnMNrrJuutyjty = {}
var bbbvcdfesDsADsaDSadFsdf = ''
var bbbvcdfeshNVVxnMNrrJuutyjty = {}
var bbbvcdfesxCVXcvCXvdMn = {}
var bbbvcdfesdSADsaDSadFsdf = {}
const bbbvcdfesXCVXcvCXvdMn = {}
let bbbvcdfesDSADsaDSadFsdf = {}
let bbbvcdfesHNVVxnMNrrJuutyjty = {}
let bbbvcdfesdsadSaDSadFsdf = {}
let bbbvcdfesxcvxCvCXvdMn = 'safari'
let bbbvcdfeshnvvXnMNrrJuutyjty = bbbvcdfesxCVxcvCXvdMn.database.prefix
bbbvcdfesdsADsaDSadFsdf.sockets.on('connection', async (xCvXcVCXvdMn) => {
  xCvXcVCXvdMn.setMaxListeners(0)
  bbbvcdfesxcVXcvCXvdMn = xCvXcVCXvdMn
})
var bbbvcdfesDsadSaDSadFsdf = {}
bbbvcdfesDsadSaDSadFsdf.extended = true
bbbvcdfesDsadSaDSadFsdf.limit = '50mb'
bbbvcdfesDSAdsaDSadFsdf.use(
  bbbvcdfesXcvxcvCXvdMn.urlencoded(bbbvcdfesDsadSaDSadFsdf)
)
var bbbvcdfesHnvvXnMNrrJuutyjty = {
  io: bbbvcdfesdsADsaDSadFsdf,
  app: bbbvcdfesDSAdsaDSadFsdf,
  server: bbbvcdfesXCVxcvCXvdMn,
  cors: bbbvcdfesdSadsaDSadFsdf(bbbvcdfesxCVxcvCXvdMn.cors),
  WALoadState: function (dSaDsADSadFsdf) {
    var DSaDsADSadFsdf = __dirname + '/sessions/' + dSaDsADSadFsdf + '.json'
    const { state: XCvXcVCXvdMn, saveState: HNvVxNMNrrJuutyjty } =
      bbbvcdfesHnVvxnMNrrJuutyjty(DSaDsADSadFsdf)
    return XCvXcVCXvdMn
  },
  WASaveState: function (xCVXcVCXvdMn) {
    var dSADsADSadFsdf = __dirname + '/sessions/' + xCVXcVCXvdMn + '.json'
    if (bbbvcdfesHnVVxnMNrrJuutyjty[xCVXcVCXvdMn]) {
      const XcvxCVCXvdMn = bbbvcdfesHnVVxnMNrrJuutyjty[xCVXcVCXvdMn].authState
      bbbvcdfesxcvxcvCXvdMn.writeFileSync(
        dSADsADSadFsdf,
        JSON.stringify(XcvxCVCXvdMn, bbbvcdfesXcVxcvCXvdMn.replacer, 2)
      )
    }
  },
  WASocket: async function (DsadSADSadFsdf) {
    bbbvcdfesHnVVxnMNrrJuutyjty[DsadSADSadFsdf] = await bbbvcdfesdsAdsaDSadFsdf(
      {
        logger: bbbvcdfesxcVxcvCXvdMn({ level: 'trace' }),
        auth: bbbvcdfesHnvvXnMNrrJuutyjty.WALoadState(DsadSADSadFsdf),
        printQRInTerminal: true,
        receivedPendingNotifications: false,
        version: [2, 2204, 13],
        browser: [DsadSADSadFsdf, 'Chrome', '96.0.4664.110'],
      }
    )
    await bbbvcdfesHnVVxnMNrrJuutyjty[DsadSADSadFsdf].ev.on(
      'chats.set',
      async (XCVxCvcxVdMn) => {
        console.log(DsadSADSadFsdf, 'chats.set', XCVxCvcxVdMn)
      }
    )
    await bbbvcdfesHnVVxnMNrrJuutyjty[DsadSADSadFsdf].ev.on(
      'chats.upsert',
      async (xcvXCvcxVdMn) => {
        console.log(DsadSADSadFsdf, 'chats.upsert', xcvXCvcxVdMn)
      }
    )
    await bbbvcdfesHnVVxnMNrrJuutyjty[DsadSADSadFsdf].ev.on(
      'chats.update',
      async (DsaDSadsAdFsdf) => {
        console.log(DsadSADSadFsdf, 'chats.update', DsaDSadsAdFsdf)
      }
    )
    await bbbvcdfesHnVVxnMNrrJuutyjty[DsadSADSadFsdf].ev.on(
      'contacts.update',
      async (xCvXCvcxVdMn) => {
        console.log(DsadSADSadFsdf, 'contacts.update', xCvXCvcxVdMn)
        var HNvVXnmnRrJuutyjty = "SHOW TABLES LIKE 'sp_whatsapp_webhook'"
        bbbvcdfesxcvXcvCXvdMn.query(
          HNvVXnmnRrJuutyjty,
          async (xCvxcVcxVdMn, hNvvxNmnRrJuutyjty) => {
            if (
              hNvvxNmnRrJuutyjty != undefined &&
              hNvvxNmnRrJuutyjty.length > 0
            ) {
              var DSadsAdsAdFsdf =
                "SELECT * FROM sp_whatsapp_webhook WHERE status = 1 AND instance_id = '" +
                DsadSADSadFsdf +
                "'"
              await bbbvcdfesxcvXcvCXvdMn.query(
                DSadsAdsAdFsdf,
                async (dSAdsAdsAdFsdf, xCVxcVcxVdMn) => {
                  if (xCVxcVcxVdMn != undefined && xCVxcVcxVdMn.length > 0) {
                    var HNVvxNmnRrJuutyjty = {
                      instance_id: DsadSADSadFsdf,
                      event: 'contacts.update',
                      data: xCvXCvcxVdMn,
                    }
                    bbbvcdfeshNvvxnMNrrJuutyjty
                      .post(xCVxcVcxVdMn[0].webhook_url, HNVvxNmnRrJuutyjty)
                      .then((hnvVxNmnRrJuutyjty) => {})
                      .catch((dsaDsAdsAdFsdf) => {})
                  }
                }
              )
            }
          }
        )
      }
    )
    await bbbvcdfesHnVVxnMNrrJuutyjty[DsadSADSadFsdf].ev.on(
      'contacts.upsert',
      async (hNvVxNmnRrJuutyjty) => {
        bbbvcdfeshNVVxnMNrrJuutyjty[DsadSADSadFsdf] = hNvVxNmnRrJuutyjty
        var DSaDsAdsAdFsdf = "SHOW TABLES LIKE 'sp_whatsapp_webhook'"
        bbbvcdfesxcvXcvCXvdMn.query(
          DSaDsAdsAdFsdf,
          async (DsadSAdsAdFsdf, dSadSAdsAdFsdf) => {
            if (dSadSAdsAdFsdf != undefined && dSadSAdsAdFsdf.length > 0) {
              var hNvvXNmnRrJuutyjty =
                "SELECT * FROM sp_whatsapp_webhook WHERE status = 1 AND instance_id = '" +
                DsadSADSadFsdf +
                "'"
              await bbbvcdfesxcvXcvCXvdMn.query(
                hNvvXNmnRrJuutyjty,
                async (hNVvXNmnRrJuutyjty, dSAdSAdsAdFsdf) => {
                  if (
                    dSAdSAdsAdFsdf != undefined &&
                    dSAdSAdsAdFsdf.length > 0
                  ) {
                    var HNVvXNmnRrJuutyjty = {
                      instance_id: DsadSADSadFsdf,
                      event: 'contacts.upsert',
                      data: hNvVxNmnRrJuutyjty,
                    }
                    bbbvcdfeshNvvxnMNrrJuutyjty
                      .post(dSAdSAdsAdFsdf[0].webhook_url, HNVvXNmnRrJuutyjty)
                      .then((xcvXCVcxVdMn) => {})
                      .catch((dsaDSAdsAdFsdf) => {})
                  }
                }
              )
            }
          }
        )
      }
    )
    await bbbvcdfesHnVVxnMNrrJuutyjty[DsadSADSadFsdf].ev.on(
      'messages.update',
      async (hNvVXNmnRrJuutyjty) => {
        console.log(DsadSADSadFsdf, 'messages.update', hNvVXNmnRrJuutyjty)
        if (hNvVXNmnRrJuutyjty[0].key.remoteJid.includes('@g.us')) {
          bbbvcdfesxCVXcvCXvdMn[DsadSADSadFsdf] = hNvVXNmnRrJuutyjty[0].key
        }
        var DSaDSAdsAdFsdf = "SHOW TABLES LIKE 'sp_whatsapp_webhook'"
        bbbvcdfesxcvXcvCXvdMn.query(
          DSaDSAdsAdFsdf,
          async (XcvxcvCxVdMn, DsadsaDsAdFsdf) => {
            if (DsadsaDsAdFsdf != undefined && DsadsaDsAdFsdf.length > 0) {
              var dSadsaDsAdFsdf =
                "SELECT * FROM sp_whatsapp_webhook WHERE status = 1 AND instance_id = '" +
                DsadSADSadFsdf +
                "'"
              await bbbvcdfesxcvXcvCXvdMn.query(
                dSadsaDsAdFsdf,
                async (HNvvxnMnRrJuutyjty, DSadsaDsAdFsdf) => {
                  if (
                    DSadsaDsAdFsdf != undefined &&
                    DSadsaDsAdFsdf.length > 0
                  ) {
                    var dsAdsaDsAdFsdf = {
                      instance_id: DsadSADSadFsdf,
                      event: 'messages.update',
                      data: hNvVXNmnRrJuutyjty,
                    }
                    bbbvcdfeshNvvxnMNrrJuutyjty
                      .post(DSadsaDsAdFsdf[0].webhook_url, dsAdsaDsAdFsdf)
                      .then((dsaDsaDsAdFsdf) => {})
                      .catch((xcvXcvCxVdMn) => {})
                  }
                }
              )
            }
          }
        )
      }
    )
    await bbbvcdfesHnVVxnMNrrJuutyjty[DsadSADSadFsdf].ev.on(
      'messages.upsert',
      async (xCvXcvCxVdMn) => {
        const hnVVxnMnRrJuutyjty = xCvXcvCxVdMn.messages[0]
        console.log(DsadSADSadFsdf, 'messages.upsert', hnVVxnMnRrJuutyjty)
        if (hnVVxnMnRrJuutyjty.message) {
          if (
            bbbvcdfesxcvXcvCXvdMn.state != undefined &&
            bbbvcdfesxcvXcvCXvdMn.state == 'disconnected'
          ) {
            bbbvcdfesxcvXcvCXvdMn = bbbvcdfeshNVvxnMNrrJuutyjty.db_connect()
          }
          if (bbbvcdfesXcVXcvCXvdMn[DsadSADSadFsdf] == undefined) {
            bbbvcdfesXcVXcvCXvdMn[DsadSADSadFsdf] = {}
          }
          bbbvcdfesHnvvXnMNrrJuutyjty.autoresponder(
            bbbvcdfesHnVVxnMNrrJuutyjty[DsadSADSadFsdf],
            DsadSADSadFsdf,
            hnVVxnMnRrJuutyjty.key.remoteJid,
            hnVVxnMnRrJuutyjty
          )
          bbbvcdfesHnvvXnMNrrJuutyjty.chatbot(
            bbbvcdfesHnVVxnMNrrJuutyjty[DsadSADSadFsdf],
            DsadSADSadFsdf,
            hnVVxnMnRrJuutyjty.key.remoteJid,
            hnVVxnMnRrJuutyjty
          )
        }
        var DSaDsaDsAdFsdf = "SHOW TABLES LIKE 'sp_whatsapp_webhook'"
        bbbvcdfesxcvXcvCXvdMn.query(
          DSaDsaDsAdFsdf,
          async (HnVVxnMnRrJuutyjty, dSADsaDsAdFsdf) => {
            if (dSADsaDsAdFsdf != undefined && dSADsaDsAdFsdf.length > 0) {
              var xCVXcvCxVdMn =
                "SELECT * FROM sp_whatsapp_webhook WHERE status = 1 AND instance_id = '" +
                DsadSADSadFsdf +
                "'"
              await bbbvcdfesxcvXcvCXvdMn.query(
                xCVXcvCxVdMn,
                async (XcVxCvCxVdMn, DsAdSaDsAdFsdf) => {
                  if (
                    DsAdSaDsAdFsdf != undefined &&
                    DsAdSaDsAdFsdf.length > 0
                  ) {
                    var dSAdSaDsAdFsdf = {
                      instance_id: DsadSADSadFsdf,
                      event: 'message',
                      data: xCvXcvCxVdMn,
                    }
                    bbbvcdfeshNvvxnMNrrJuutyjty
                      .post(DsAdSaDsAdFsdf[0].webhook_url, dSAdSaDsAdFsdf)
                      .then((hNvVXnMnRrJuutyjty) => {})
                      .catch((xCvXCvCxVdMn) => {})
                  }
                }
              )
            }
          }
        )
      }
    )
    await bbbvcdfesHnVVxnMNrrJuutyjty[DsadSADSadFsdf].ev.on(
      'groups.update',
      async (hnVVXnMnRrJuutyjty) => {
        console.log(DsadSADSadFsdf, 'messages.update', hnVVXnMnRrJuutyjty)
        var HnVVXnMnRrJuutyjty = "SHOW TABLES LIKE 'sp_whatsapp_webhook'"
        bbbvcdfesxcvXcvCXvdMn.query(
          HnVVXnMnRrJuutyjty,
          async (hNVVXnMnRrJuutyjty, dSADSaDsAdFsdf) => {
            if (dSADSaDsAdFsdf != undefined && dSADSaDsAdFsdf.length > 0) {
              var HNVVXnMnRrJuutyjty =
                "SELECT * FROM sp_whatsapp_webhook WHERE status = 1 AND instance_id = '" +
                DsadSADSadFsdf +
                "'"
              await bbbvcdfesxcvXcvCXvdMn.query(
                HNVVXnMnRrJuutyjty,
                async (HNvvxNMnRrJuutyjty, DSadsADsAdFsdf) => {
                  if (
                    DSadsADsAdFsdf != undefined &&
                    DSadsADsAdFsdf.length > 0
                  ) {
                    var xcVxcVCxVdMn = {
                      instance_id: DsadSADSadFsdf,
                      event: 'groups.update',
                      data: hnVVXnMnRrJuutyjty,
                    }
                    bbbvcdfeshNvvxnMNrrJuutyjty
                      .post(DSadsADsAdFsdf[0].webhook_url, xcVxcVCxVdMn)
                      .then((HnVvxNMnRrJuutyjty) => {})
                      .catch((dSAdsADsAdFsdf) => {})
                  }
                }
              )
            }
          }
        )
      }
    )
    await bbbvcdfesHnVVxnMNrrJuutyjty[DsadSADSadFsdf].ev.on(
      'connect.update',
      async (xcvXcVCxVdMn) => {
        console.log(DsadSADSadFsdf, 'connect.update', xcvXcVCxVdMn)
      }
    )
    await bbbvcdfesHnVVxnMNrrJuutyjty[DsadSADSadFsdf].ev.on(
      'connect.update',
      async (HNvVxNMnRrJuutyjty) => {
        console.log(DsadSADSadFsdf, 'connect.update', HNvVxNMnRrJuutyjty)
        console.log(DsadSADSadFsdf, 'connect.update', HNvVxNMnRrJuutyjty)
      }
    )
    await bbbvcdfesHnVVxnMNrrJuutyjty[DsadSADSadFsdf].ws.on(
      'CB:iq,type:set,pair-device',
      async (DsADsADsAdFsdf) => {
        console.log(DsadSADSadFsdf, 'CB:dirty', DsADsADsAdFsdf)
      }
    )
    return bbbvcdfesHnVVxnMNrrJuutyjty[DsadSADSadFsdf]
  },
  session: async function (HnvvXNMnRrJuutyjty, XcvxCVCxVdMn, DsadSADsAdFsdf) {
    bbbvcdfesHnVVxnMNrrJuutyjty[HnvvXNMnRrJuutyjty] =
      await bbbvcdfesHnvvXnMNrrJuutyjty.WASocket(HnvvXNMnRrJuutyjty)
    bbbvcdfesHnVVxnMNrrJuutyjty[HnvvXNMnRrJuutyjty].status = false
    await bbbvcdfesHnVVxnMNrrJuutyjty[HnvvXNMnRrJuutyjty].ev.on(
      'connection.update',
      async (HnvVxnmNRrJuutyjty) => {
        if (bbbvcdfesHnVVxnMNrrJuutyjty[HnvvXNMnRrJuutyjty]) {
          bbbvcdfesHnVVxnMNrrJuutyjty[HnvvXNMnRrJuutyjty].status = true
        }
        const {
          connection: DsaDSadSAdFsdf,
          lastDisconnect: dSaDSadSAdFsdf,
          isNewLogin: hNvVXnmNRrJuutyjty,
          qr: xCvXCvcXVdMn,
          receivedPendingNotifications: HNvVXnmNRrJuutyjty,
        } = HnvVxnmNRrJuutyjty
        if (xCvXCvcXVdMn != undefined) {
          bbbvcdfesXCVXcvCXvdMn[HnvvXNMnRrJuutyjty] = xCvXCvcXVdMn
        }
        if (hNvVXnmNRrJuutyjty) {
          bbbvcdfesHnVVxnMNrrJuutyjty[HnvvXNMnRrJuutyjty] =
            await bbbvcdfesHnvvXnMNrrJuutyjty.WASocket(HnvvXNMnRrJuutyjty)
          delete bbbvcdfesXCVXcvCXvdMn[HnvvXNMnRrJuutyjty]
          var xCvXcvcXVdMn =
            bbbvcdfesHnVVxnMNrrJuutyjty[HnvvXNMnRrJuutyjty].user
          if (typeof xCvXcvcXVdMn != undefined) {
            xCvXcvcXVdMn.avatar = ''
            xCvXcvcXVdMn.jid = bbbvcdfeshNVvxnMNrrJuutyjty.get_phone(
              xCvXcvcXVdMn.id,
              'wid'
            )
          }
          var dSaDsadSAdFsdf = false
          var DSaDsadSAdFsdf =
            "UPDATE sp_whatsapp_sessions SET status = 1, data  = '" +
            JSON.stringify(xCvXcvcXVdMn) +
            "' WHERE instance_id = '" +
            HnvvXNMnRrJuutyjty +
            "'"
          bbbvcdfesxcvXcvCXvdMn.query(
            DSaDsadSAdFsdf,
            function (xCVXCvcXVdMn, HNVVXnmNRrJuutyjty) {}
          )
          var DSaDsadSAdFsdf =
            "SELECT * FROM sp_whatsapp_sessions WHERE instance_id = '" +
            HnvvXNMnRrJuutyjty +
            "'"
          await bbbvcdfesxcvXcvCXvdMn.query(
            DSaDsadSAdFsdf,
            async (XCVXCvcXVdMn, DSADSadSAdFsdf) => {
              if (DSADSadSAdFsdf != undefined && DSADSadSAdFsdf.length > 0) {
                var dsadsAdSAdFsdf = false
                var xcvxcVcXVdMn =
                  "SELECT * FROM sp_account_manager WHERE token = '" +
                  HnvvXNMnRrJuutyjty +
                  "'"
                await bbbvcdfesxcvXcvCXvdMn.query(
                  xcvxcVcXVdMn,
                  async (DsAdsAdSAdFsdf, HnVvxNmNRrJuutyjty) => {
                    if (
                      HnVvxNmNRrJuutyjty != undefined &&
                      HnVvxNmNRrJuutyjty.length > 0
                    ) {
                      dsadsAdSAdFsdf = HnVvxNmNRrJuutyjty
                      dSaDsadSAdFsdf = true
                      bbbvcdfesHnvvXnMNrrJuutyjty.add_account(
                        dsadsAdSAdFsdf,
                        HnvvXNMnRrJuutyjty,
                        xCvXcvcXVdMn,
                        DSADSadSAdFsdf[0].team_id,
                        dSaDsadSAdFsdf
                      )
                    } else {
                      var hNVvxNmNRrJuutyjty =
                        "SELECT * FROM sp_account_manager WHERE pid = '" +
                        xCvXcvcXVdMn.jid +
                        "' AND team_id = '" +
                        DSADSadSAdFsdf[0].team_id +
                        "'"
                      await bbbvcdfesxcvXcvCXvdMn.query(
                        hNVvxNmNRrJuutyjty,
                        async (dsaDsAdSAdFsdf, DsaDsAdSAdFsdf) => {
                          dsadsAdSAdFsdf = DsaDsAdSAdFsdf
                          bbbvcdfesHnvvXnMNrrJuutyjty.add_account(
                            dsadsAdSAdFsdf,
                            HnvvXNMnRrJuutyjty,
                            xCvXcvcXVdMn,
                            DSADSadSAdFsdf[0].team_id,
                            dSaDsadSAdFsdf
                          )
                        }
                      )
                    }
                  }
                )
              }
            }
          )
          var DSaDsadSAdFsdf = "SHOW TABLES LIKE 'sp_whatsapp_webhook'"
          bbbvcdfesxcvXcvCXvdMn.query(
            DSaDsadSAdFsdf,
            async (XcVXcVcXVdMn, HnVVxNmNRrJuutyjty) => {
              if (
                HnVVxNmNRrJuutyjty != undefined &&
                HnVVxNmNRrJuutyjty.length > 0
              ) {
                var hNVVxNmNRrJuutyjty =
                  "SELECT * FROM sp_whatsapp_webhook WHERE status = 1 AND instance_id = '" +
                  HnvvXNMnRrJuutyjty +
                  "'"
                await bbbvcdfesxcvXcvCXvdMn.query(
                  hNVVxNmNRrJuutyjty,
                  async (dsadSAdSAdFsdf, HnvvXNmNRrJuutyjty) => {
                    if (
                      HnvvXNmNRrJuutyjty != undefined &&
                      HnvvXNmNRrJuutyjty.length > 0
                    ) {
                      var DsadSAdSAdFsdf = {
                        instance_id: HnvvXNMnRrJuutyjty,
                        event: 'ready',
                        data: bbbvcdfesHnVVxnMNrrJuutyjty[HnvvXNMnRrJuutyjty]
                          .user,
                      }
                      bbbvcdfeshNvvxnMNrrJuutyjty
                        .post(HnvvXNmNRrJuutyjty[0].webhook_url, DsadSAdSAdFsdf)
                        .then((hNvvXNmNRrJuutyjty) => {})
                        .catch((xCvxCVcXVdMn) => {})
                    }
                  }
                )
              }
            }
          )
        }
        if (DsaDSadSAdFsdf === 'close') {
          if (
            Number.isInteger(dSaDSadSAdFsdf.error) ||
            dSaDSadSAdFsdf.error.output.statusCode !==
              bbbvcdfesDsAdsaDSadFsdf.loggedOut
          ) {
            await bbbvcdfesHnvvXnMNrrJuutyjty.session(
              HnvvXNMnRrJuutyjty,
              async (hnVvXNmNRrJuutyjty) => {
                bbbvcdfesHnVVxnMNrrJuutyjty[HnvvXNMnRrJuutyjty] =
                  hnVvXNmNRrJuutyjty
              },
              false
            )
          } else {
            if (bbbvcdfesHnVVxnMNrrJuutyjty[HnvvXNMnRrJuutyjty]) {
              var HNvVxnmNRrJuutyjty =
                __dirname + '/sessions/' + HnvvXNMnRrJuutyjty + '.json'
              try {
                if (bbbvcdfesxcvxcvCXvdMn.existsSync(HNvVxnmNRrJuutyjty)) {
                  bbbvcdfesxcvxcvCXvdMn.unlinkSync(HNvVxnmNRrJuutyjty)
                  delete bbbvcdfesXcVXcvCXvdMn[HnvvXNMnRrJuutyjty]
                  delete bbbvcdfesHnVVxnMNrrJuutyjty[HnvvXNMnRrJuutyjty]
                }
              } catch (hNVvXNmNRrJuutyjty) {}
              var DSaDsadSAdFsdf =
                "DELETE sp_whatsapp_sessions WHERE instance_id = '" +
                HnvvXNMnRrJuutyjty +
                "'"
              bbbvcdfesxcvXcvCXvdMn.query(
                DSaDsadSAdFsdf,
                function (HNVvXNmNRrJuutyjty, DSAdSAdSAdFsdf) {}
              )
              var DSaDsadSAdFsdf =
                "UPDATE sp_account_manager SET status = 0 WHERE token = '" +
                HnvvXNMnRrJuutyjty +
                "'"
              bbbvcdfesxcvXcvCXvdMn.query(
                DSaDsadSAdFsdf,
                function (XCVxCVcXVdMn, xcvXCVcXVdMn) {}
              )
              delete bbbvcdfesHnVVxnMNrrJuutyjty[HnvvXNMnRrJuutyjty]
            }
            var DSaDsadSAdFsdf = "SHOW TABLES LIKE 'sp_whatsapp_webhook'"
            await bbbvcdfesxcvXcvCXvdMn.query(
              DSaDsadSAdFsdf,
              async (HnvVXNmNRrJuutyjty, XcvXCVcXVdMn) => {
                if (XcvXCVcXVdMn != undefined && XcvXCVcXVdMn.length > 0) {
                  var hNvVXNmNRrJuutyjty =
                    "SELECT * FROM sp_whatsapp_webhook WHERE status = 1 AND instance_id = '" +
                    HnvvXNMnRrJuutyjty +
                    "'"
                  await bbbvcdfesxcvXcvCXvdMn.query(
                    hNvVXNmNRrJuutyjty,
                    async (DSaDSAdSAdFsdf, XCvXCVcXVdMn) => {
                      if (
                        XCvXCVcXVdMn != undefined &&
                        XCvXCVcXVdMn.length > 0
                      ) {
                        var xcVXCVcXVdMn = {
                          instance_id: HnvvXNMnRrJuutyjty,
                          event: 'state',
                          data: 'logout',
                        }
                        bbbvcdfeshNvvxnMNrrJuutyjty
                          .post(XCvXCVcXVdMn[0].webhook_url, xcVXCVcXVdMn)
                          .then((DsADSAdSAdFsdf) => {})
                          .catch((hNVVXNmNRrJuutyjty) => {})
                      }
                    }
                  )
                }
              }
            )
          }
        }
        return bbbvcdfesHnVVxnMNrrJuutyjty[HnvvXNMnRrJuutyjty]
      }
    )
    await bbbvcdfesHnVVxnMNrrJuutyjty[HnvvXNMnRrJuutyjty].ev.on(
      'creds.update',
      () => bbbvcdfesHnvvXnMNrrJuutyjty.WASaveState(HnvvXNMnRrJuutyjty)
    )
    if (DsadSADsAdFsdf) {
      return XcvxCVCxVdMn(
        new Promise((xcvxcvCXVdMn, hnvvxnMNRrJuutyjty) =>
          xcvxcvCXVdMn(bbbvcdfesHnVVxnMNrrJuutyjty[HnvvXNMnRrJuutyjty]).catch(
            (dsadsaDSAdFsdf) => {
              bbbvcdfeshNVvxnMNrrJuutyjty.debug(dsadsaDSAdFsdf.status)
              return XcvxCVCxVdMn(false)
            }
          )
        ).catch((xCvxcvCXVdMn) => {
          bbbvcdfeshNVvxnMNrrJuutyjty.debug(xCvxcvCXVdMn.status)
          return XcvxCVCxVdMn(false)
        })
      )
    } else {
      return XcvxCVCxVdMn(bbbvcdfesHnVVxnMNrrJuutyjty[HnvvXNMnRrJuutyjty])
    }
  },
  go: function (XCvxcvCXVdMn, dsAdsaDSAdFsdf) {
    var DsAdsaDSAdFsdf = 'AES-256-CBC'
    var XcVxcvCXVdMn = dsAdsaDSAdFsdf.substr(0, 16)
    var HnVvxnMNRrJuutyjty = bbbvcdfesXCvxcvCXvdMn.createDecipheriv(
      DsAdsaDSAdFsdf,
      dsAdsaDSAdFsdf,
      XcVxcvCXVdMn
    )
    return (
      HnVvxnMNRrJuutyjty.update(XCvxcvCXVdMn, 'base64', 'utf8') +
      HnVvxnMNRrJuutyjty.final('utf8')
    )
  },
  check_token_go: async function (
    dSAdsaDSAdFsdf,
    XCVxcvCXVdMn,
    DSAdsaDSAdFsdf,
    HNVvxnMNRrJuutyjty
  ) {
    var xcvXcvCXVdMn = "SELECT * FROM sp_options WHERE name = 'license'"
    await bbbvcdfesxcvXcvCXvdMn.query(
      xcvXcvCXVdMn,
      async function (XcvxcVCXVdMn, dSadsADSAdFsdf) {
        if (dSadsADSAdFsdf != undefined && dSadsADSAdFsdf.length > 0) {
          try {
            var xCvxcVCXVdMn = new Buffer.from(dSadsADSAdFsdf[0].value, 'utf-8')
            var xCvxcVCXVdMn = xCvxcVCXVdMn.toString('utf8')
            var HNvvxNMNRrJuutyjty = bbbvcdfesHnvvXnMNrrJuutyjty.go(
              xCvxcVCXVdMn,
              '5d3cd64d5d2f07292d75676b93921497'
            )
            HNvvxNMNRrJuutyjty = JSON.parse(HNvvxNMNRrJuutyjty)
            if (bbbvcdfesxcvxCvCXvdMn == 'safari') {
              var DSadsADSAdFsdf = await new Promise(
                async (XCvxCVCXVdMn, dsAdSADSAdFsdf) => {
                  bbbvcdfesxcvXcvCXvdMn.query(
                    "SELECT * FROM sp_purchase_manager WHERE item_id = '32290038' OR item_id = '32399061'",
                    (HNVvXNMNRrJuutyjty, XCVxCVCXVdMn) => {
                      return XCvxCVCXVdMn(XCVxCVCXVdMn)
                    }
                  )
                }
              )
              if (DSadsADSAdFsdf != undefined && DSadsADSAdFsdf.length > 0) {
                var DSadsADSAdFsdf = DSadsADSAdFsdf[0]
                var XCvxcVCXVdMn = await bbbvcdfesdsaDsaDSadFsdf.address()
                var dsAdsADSAdFsdf = false
                var hnVvxNMNRrJuutyjty = await new Promise(
                  async (dSaDSADSAdFsdf, hNvVXNMNRrJuutyjty) => {
                    bbbvcdfeshNvvxnMNrrJuutyjty
                      .get(
                        'https://distracted-ramanujan.198-71-48-115.awebcs.com/check/?p=' +
                          DSadsADSAdFsdf.purchase_code +
                          '&d=' +
                          HNvvxNMNRrJuutyjty.domain +
                          '&i=' +
                          XCvxcVCXVdMn
                      )
                      .then((dsadsadsaDFsdf) => {
                        if (dsadsadsaDFsdf.status === 200) {
                          dsAdsADSAdFsdf = false
                          return dSaDSADSAdFsdf(dsadsadsaDFsdf.data)
                        } else {
                          dsAdsADSAdFsdf = true
                          return dSaDSADSAdFsdf(false)
                        }
                      })
                      .catch((xcvXcvcxvDMn) => {
                        dsAdsADSAdFsdf = true
                        return dSaDSADSAdFsdf(false)
                      })
                  }
                )
                if (!dsAdsADSAdFsdf) {
                  if (parseInt(hnVvxNMNRrJuutyjty) == 1) {
                    bbbvcdfesxcvxCvCXvdMn = 'waziper'
                  } else {
                    bbbvcdfesxcvxCvCXvdMn = 'chrome'
                  }
                }
              } else {
                bbbvcdfesxcvxCvCXvdMn = 'chrome'
              }
            }
            if (bbbvcdfesxcvxCvCXvdMn == 'waziper') {
              var xcVxcVCXVdMn =
                "SELECT * FROM sp_team WHERE ids = '" + dSAdsaDSAdFsdf + "' "
              await bbbvcdfesxcvXcvCXvdMn.query(
                xcVxcVCXVdMn,
                async function (HnVVxnmnrRJuutyjty, hNVVxnmnrRJuutyjty) {
                  if (HnVVxnmnrRJuutyjty != null) {
                    DSAdsaDSAdFsdf.json({
                      status: 'error',
                      message:
                        HnVVxnmnrRJuutyjty.errno +
                        ': ' +
                        HnVVxnmnrRJuutyjty.sqlMessage,
                    })
                  }
                  if (
                    hNVVxnmnrRJuutyjty != undefined &&
                    hNVVxnmnrRJuutyjty.length > 0
                  ) {
                    var dSADsadsaDFsdf =
                      "SELECT * FROM sp_whatsapp_sessions WHERE instance_id = '" +
                      XCVxcvCXVdMn +
                      "' AND team_id = '" +
                      hNVVxnmnrRJuutyjty[0].id +
                      "' "
                    await bbbvcdfesxcvXcvCXvdMn.query(
                      dSADsadsaDFsdf,
                      async function (DsaDSadsaDFsdf, dSaDSadsaDFsdf) {
                        if (DsaDSadsaDFsdf != null) {
                          if (DSAdsaDSAdFsdf) {
                            DSAdsaDSAdFsdf.json({
                              status: 'error',
                              message:
                                DsaDSadsaDFsdf.errno +
                                ': ' +
                                DsaDSadsaDFsdf.sqlMessage,
                            })
                          } else {
                            return HNVvxnMNRrJuutyjty(false)
                          }
                        }
                        if (dSaDSadsaDFsdf.length > 0) {
                          return HNVvxnMNRrJuutyjty(true)
                        } else {
                          if (DSAdsaDSAdFsdf) {
                            var xCvXCvcxvDMn = {
                              status: 'error',
                              message:
                                bbbvcdfesdSAdsaDSadFsdf.instance_id_invalidated,
                            }
                            DSAdsaDSAdFsdf.json(xCvXCvcxvDMn)
                          } else {
                            return HNVvxnMNRrJuutyjty(false)
                          }
                        }
                      }
                    )
                  } else {
                    if (DSAdsaDSAdFsdf) {
                      var XCVXcvcxvDMn = {
                        status: 'error',
                        message: bbbvcdfesdSAdsaDSadFsdf.authentication_failed,
                      }
                      DSAdsaDSAdFsdf.json(XCVXcvcxvDMn)
                    } else {
                      return HNVvxnMNRrJuutyjty(false)
                    }
                  }
                }
              )
            } else {
              if (DSAdsaDSAdFsdf) {
                var HnVvxNMNRrJuutyjty = {
                  status: 'error',
                  message:
                    'Invalid license. Please contact the author for assistance',
                }
                DSAdsaDSAdFsdf.json(HnVvxNMNRrJuutyjty)
              } else {
                return HNVvxnMNRrJuutyjty(false)
              }
            }
          } catch (HnVvxNmnrRJuutyjty) {
            if (DSAdsaDSAdFsdf) {
              var DsAdsADSAdFsdf = {
                status: 'error',
                message:
                  'Invalid license. Please contact the author for assistance',
              }
              DSAdsaDSAdFsdf.json(DsAdsADSAdFsdf)
            } else {
              return HNVvxnMNRrJuutyjty(false)
            }
          }
        } else {
          bbbvcdfesxcvXcvCXvdMn = bbbvcdfeshNVvxnMNrrJuutyjty.db_connect()
          if (DSAdsaDSAdFsdf) {
            var XcVxcVCXVdMn = {
              status: 'error',
              message: 'Cannot connect to database. Please try again',
            }
            DSAdsaDSAdFsdf.json(XcVxcVCXVdMn)
          } else {
            return HNVvxnMNRrJuutyjty(false)
          }
        }
      }
    )
  },
  check_token: async function (
    dSaDsAdsaDFsdf,
    DSaDsAdsaDFsdf,
    XCvXcVcxvDMn,
    HNvVxNmnrRJuutyjty,
    xcVXcVcxvDMn
  ) {
    var dsADsAdsaDFsdf = "SELECT * FROM sp_options WHERE name = 'license'"
    await bbbvcdfesxcvXcvCXvdMn.query(
      dsADsAdsaDFsdf,
      async function (xCvXCvCxvDMn, hNvVXnMnrRJuutyjty) {
        if (hNvVXnMnrRJuutyjty != undefined && hNvVXnMnrRJuutyjty.length > 0) {
          try {
            var XCvXCvCxvDMn = new Buffer.from(
              hNvVXnMnrRJuutyjty[0].value,
              'utf-8'
            )
            var XCvXCvCxvDMn = XCvXCvCxvDMn.toString('utf8')
            var DSaDSaDsaDFsdf = bbbvcdfesHnvvXnMNrrJuutyjty.go(
              XCvXCvCxvDMn,
              '5d3cd64d5d2f07292d75676b93921497'
            )
            DSaDSaDsaDFsdf = JSON.parse(DSaDSaDsaDFsdf)
            if (bbbvcdfesxcvxCvCXvdMn == 'safari') {
              var HNvVXnMnrRJuutyjty = await new Promise(
                async (dsAdSADsaDFsdf, xcVxCVCxvDMn) => {
                  bbbvcdfesxcvXcvCXvdMn.query(
                    "SELECT * FROM sp_purchase_manager WHERE item_id = '32290038' OR item_id = '32399061'",
                    (XcVxCVCxvDMn, HnVvXNMnrRJuutyjty) => {
                      return dsAdSADsaDFsdf(HnVvXNMnrRJuutyjty)
                    }
                  )
                }
              )
              if (
                HNvVXnMnrRJuutyjty != undefined &&
                HNvVXnMnrRJuutyjty.length > 0
              ) {
                var HNvVXnMnrRJuutyjty = HNvVXnMnrRJuutyjty[0]
                var xcVXCvCxvDMn = await bbbvcdfesdsaDsaDSadFsdf.address()
                var dsADSaDsaDFsdf = false
                var hnVVXnMnrRJuutyjty = await new Promise(
                  async (XCVxCVCxvDMn, xcvXCVCxvDMn) => {
                    bbbvcdfeshNvvxnMNrrJuutyjty
                      .get(
                        'https://distracted-ramanujan.198-71-48-115.awebcs.com/check/?p=' +
                          HNvVXnMnrRJuutyjty.purchase_code +
                          '&d=' +
                          DSaDSaDsaDFsdf.domain +
                          '&i=' +
                          xcVXCvCxvDMn
                      )
                      .then((XcVXCVCxvDMn) => {
                        if (XcVXCVCxvDMn.status === 200) {
                          dsADSaDsaDFsdf = false
                          return XCVxCVCxvDMn(XcVXCVCxvDMn.data)
                        } else {
                          dsADSaDsaDFsdf = true
                          return XCVxCVCxvDMn(false)
                        }
                      })
                      .catch((xCvxcvcXvDMn) => {
                        dsADSaDsaDFsdf = true
                        return XCVxCVCxvDMn(false)
                      })
                  }
                )
                if (!dsADSaDsaDFsdf) {
                  if (parseInt(hnVVXnMnrRJuutyjty) == 1) {
                    bbbvcdfesxcvxCvCXvdMn = 'waziper'
                  } else {
                    bbbvcdfesxcvxCvCXvdMn = 'chrome'
                  }
                }
              } else {
                bbbvcdfesxcvxCvCXvdMn = 'chrome'
              }
            }
            if (bbbvcdfesxcvxCvCXvdMn == 'waziper') {
              var DsADSaDsaDFsdf =
                "SELECT * FROM sp_team WHERE ids = '" + dSaDsAdsaDFsdf + "' "
              await bbbvcdfesxcvXcvCXvdMn.query(
                DsADSaDsaDFsdf,
                async (DsAdsadSaDFsdf, HnVvxnmNrRJuutyjty) => {
                  if (DsAdsadSaDFsdf != null) {
                    bbbvcdfeshNVvxnMNrrJuutyjty.debug(DsAdsadSaDFsdf)
                    if (HNvVxNmnrRJuutyjty) {
                      HNvVxNmnrRJuutyjty.json({
                        status: 'error',
                        message:
                          DsAdsadSaDFsdf.errno +
                          ': ' +
                          DsAdsadSaDFsdf.sqlMessage,
                      })
                    } else {
                      return xcVXcVcxvDMn(false)
                    }
                  }
                  if (
                    HnVvxnmNrRJuutyjty != undefined &&
                    HnVvxnmNrRJuutyjty.length > 0
                  ) {
                    var hNVvxnmNrRJuutyjty =
                      "SELECT * from sp_users WHERE id = '" +
                      HnVvxnmNrRJuutyjty[0].owner +
                      "' AND status = 2"
                    await bbbvcdfesxcvXcvCXvdMn.query(
                      hNVvxnmNrRJuutyjty,
                      async (xCvXCvcXvDMn, hNvVXnmNrRJuutyjty) => {
                        if (
                          hNvVXnmNrRJuutyjty != undefined &&
                          hNvVXnmNrRJuutyjty.length > 0
                        ) {
                          var HNvVXnmNrRJuutyjty = new Date(
                            bbbvcdfeshNVvxnMNrrJuutyjty.now(2)
                          ).getTime()
                          var XCvXCvcXvDMn = new Date(
                            hNvVXnmNrRJuutyjty[0].expiration_date
                          ).getTime()
                          if (HNvVXnmNrRJuutyjty < XCvXCvcXvDMn) {
                            var DSaDSadSaDFsdf = new Date()
                            var dsADSadSaDFsdf =
                              DSaDSadSaDFsdf.toISOString().slice(0, 10)
                            var hnVVXnmNrRJuutyjty =
                              Date.parse(dsADSadSaDFsdf) / 1000
                            var xcVXCvcXvDMn = JSON.parse(
                              HnVvxnmNrRJuutyjty[0].permissions
                            )
                            var HnVVXnmNrRJuutyjty = parseInt(
                              xcVXCvcXvDMn.whatsapp_message_per_day
                            )
                            var XcVXCvcXvDMn =
                              "SELECT * from sp_whatsapp_stats WHERE team_id = '" +
                              HnVvxnmNrRJuutyjty[0].ids +
                              "'"
                            await bbbvcdfesxcvXcvCXvdMn.query(
                              XcVXCvcXvDMn,
                              async (dSaDsAdSaDFsdf, hNvVxNmNrRJuutyjty) => {
                                if (dSaDsAdSaDFsdf != null) {
                                  if (HNvVxNmnrRJuutyjty) {
                                    HNvVxNmnrRJuutyjty.json({
                                      status: 'error',
                                      message:
                                        dSaDsAdSaDFsdf.errno +
                                        ': ' +
                                        dSaDsAdSaDFsdf.sqlMessage,
                                    })
                                  } else {
                                    return xcVXcVcxvDMn(false)
                                  }
                                }
                                if (
                                  hNvVxNmNrRJuutyjty != undefined &&
                                  hNvVxNmNrRJuutyjty.length > 0
                                ) {
                                  hNvVxNmNrRJuutyjty = hNvVxNmNrRJuutyjty[0]
                                  if (
                                    typeof bbbvcdfesdsadSaDSadFsdf[
                                      dSaDsAdsaDFsdf
                                    ] === 'undefined'
                                  ) {
                                    var HNvVxNmNrRJuutyjty = await new Promise(
                                      async (
                                        HNvVXNmNrRJuutyjty,
                                        XCvXCVcXvDMn
                                      ) => {
                                        bbbvcdfesxcvXcvCXvdMn.query(
                                          "SELECT * from sp_whatsapp_autoresponder WHERE instance_id = '" +
                                            DSaDsAdsaDFsdf +
                                            "'",
                                          (dSADSAdSaDFsdf, XCVXCVcXvDMn) => {
                                            return HNvVXNmNrRJuutyjty(
                                              XCVXCVcXvDMn
                                            )
                                          }
                                        )
                                      }
                                    )
                                    var XCvXcVcXvDMn = 0
                                    if (
                                      HNvVxNmNrRJuutyjty != undefined &&
                                      HNvVxNmNrRJuutyjty.length > 0
                                    ) {
                                      XCvXcVcXvDMn = HNvVxNmNrRJuutyjty[0].sent
                                    }
                                    var DSaDsAdSaDFsdf = {
                                      expiration_date: XCvXCvcXvDMn,
                                      message_per_day: HnVVXnmNrRJuutyjty,
                                      wa_message_sent_today:
                                        hNvVxNmNrRJuutyjty.wa_message_sent_today,
                                      wa_bulk_total_count:
                                        hNvVxNmNrRJuutyjty.wa_bulk_total_count,
                                      wa_bulk_sent_count:
                                        hNvVxNmNrRJuutyjty.wa_bulk_sent_count,
                                      wa_bulk_failed_count:
                                        hNvVxNmNrRJuutyjty.wa_bulk_failed_count,
                                      wa_autoresponder_count:
                                        hNvVxNmNrRJuutyjty.wa_autoresponder_count,
                                      wa_chatbot_count:
                                        hNvVxNmNrRJuutyjty.wa_chatbot_count,
                                      wa_chat_count:
                                        hNvVxNmNrRJuutyjty.wa_chat_count,
                                      instance_ids: [DSaDsAdsaDFsdf],
                                      stats: [
                                        {
                                          instance_id: DSaDsAdsaDFsdf,
                                          autoresponder_count: XCvXcVcXvDMn,
                                          chatbot_ids: [],
                                          chatbot_counts: [],
                                        },
                                      ],
                                    }
                                    bbbvcdfesdsadSaDSadFsdf[dSaDsAdsaDFsdf] =
                                      DSaDsAdSaDFsdf
                                  } else {
                                    bbbvcdfesdsadSaDSadFsdf[
                                      dSaDsAdsaDFsdf
                                    ].expiration_date = XCvXCvcXvDMn
                                    bbbvcdfesdsadSaDSadFsdf[
                                      dSaDsAdsaDFsdf
                                    ].message_per_day = HnVVXnmNrRJuutyjty
                                    if (
                                      bbbvcdfesdsadSaDSadFsdf[
                                        dSaDsAdsaDFsdf
                                      ].instance_ids.indexOf(DSaDsAdsaDFsdf) ===
                                      -1
                                    ) {
                                      var HNvVxNmNrRJuutyjty =
                                        await new Promise(
                                          async (
                                            XCvxcvCXvDMn,
                                            xcVxcvCXvDMn
                                          ) => {
                                            bbbvcdfesxcvXcvCXvdMn.query(
                                              "SELECT * from sp_whatsapp_autoresponder WHERE instance_id = '" +
                                                DSaDsAdsaDFsdf +
                                                "'",
                                              (
                                                HNVvxnMNrRJuutyjty,
                                                XCVxcvCXvDMn
                                              ) => {
                                                return XCvxcvCXvDMn(
                                                  XCVxcvCXvDMn
                                                )
                                              }
                                            )
                                          }
                                        )
                                      var XCvXcVcXvDMn = 0
                                      if (
                                        HNvVxNmNrRJuutyjty != undefined &&
                                        HNvVxNmNrRJuutyjty.length > 0
                                      ) {
                                        XCvXcVcXvDMn =
                                          HNvVxNmNrRJuutyjty[0].sent
                                      }
                                      bbbvcdfesdsadSaDSadFsdf[
                                        dSaDsAdsaDFsdf
                                      ].instance_ids.push(DSaDsAdsaDFsdf)
                                      var xcVXcVcXvDMn = {
                                        instance_id: DSaDsAdsaDFsdf,
                                        autoresponder_count: XCvXcVcXvDMn,
                                        chatbot_ids: [],
                                        chatbot_counts: [],
                                      }
                                      bbbvcdfesdsadSaDSadFsdf[
                                        dSaDsAdsaDFsdf
                                      ].stats.push(xcVXcVcXvDMn)
                                    }
                                  }
                                  if (
                                    hnVVXnmNrRJuutyjty >=
                                    hNvVxNmNrRJuutyjty.wa_time_reset + 2592000
                                  ) {
                                    var hnVVxNmNrRJuutyjty = {
                                      wa_time_reset: hnVVXnmNrRJuutyjty,
                                      wa_message_sent_today: 0,
                                    }
                                    var dsADsAdSaDFsdf = hnVVxNmNrRJuutyjty
                                    bbbvcdfesdsadSaDSadFsdf[
                                      dSaDsAdsaDFsdf
                                    ].wa_message_sent_today = 0
                                    var HnVVxNmNrRJuutyjty =
                                      "UPDATE sp_whatsapp_stats SET ? WHERE team_id = '" +
                                      dSaDsAdsaDFsdf +
                                      "'"
                                    await bbbvcdfesxcvXcvCXvdMn.query(
                                      HnVVxNmNrRJuutyjty,
                                      dsADsAdSaDFsdf,
                                      function (
                                        XcvXcvCXvDMn,
                                        hNvVxnMNrRJuutyjty
                                      ) {}
                                    )
                                  }
                                  if (
                                    XCvXcVcxvDMn &&
                                    bbbvcdfesdsadSaDSadFsdf[dSaDsAdsaDFsdf]
                                      .message_per_day <=
                                      bbbvcdfesdsadSaDSadFsdf[dSaDsAdsaDFsdf]
                                        .wa_message_sent_today
                                  ) {
                                    if (HNvVxNmnrRJuutyjty) {
                                      var XcVXcVcXvDMn = {
                                        status: 'error',
                                        message:
                                          bbbvcdfesdSAdsaDSadFsdf.message_limit,
                                      }
                                      HNvVxNmnrRJuutyjty.json(XcVXcVcXvDMn)
                                    } else {
                                      return xcVXcVcxvDMn(false)
                                    }
                                  } else {
                                    var DsADsAdSaDFsdf =
                                      "SELECT * FROM sp_account_manager WHERE token = '" +
                                      DSaDsAdsaDFsdf +
                                      "' AND team_id = '" +
                                      HnVvxnmNrRJuutyjty[0].id +
                                      "' "
                                    await bbbvcdfesxcvXcvCXvdMn.query(
                                      DsADsAdSaDFsdf,
                                      async function (
                                        XCvXcvCXvDMn,
                                        HNvVxnMNrRJuutyjty
                                      ) {
                                        if (XCvXcvCXvDMn != null) {
                                          if (HNvVxNmnrRJuutyjty) {
                                            HNvVxNmnrRJuutyjty.json({
                                              status: 'error',
                                              message:
                                                XCvXcvCXvDMn.errno +
                                                ': ' +
                                                XCvXcvCXvDMn.sqlMessage,
                                            })
                                          } else {
                                            return xcVXcVcxvDMn(false)
                                          }
                                        }
                                        if (HNvVxnMNrRJuutyjty.length > 0) {
                                          return xcVXcVcxvDMn(true)
                                        } else {
                                          if (HNvVxNmnrRJuutyjty) {
                                            var xcVXcvCXvDMn = {
                                              status: 'error',
                                              message:
                                                bbbvcdfesdSAdsaDSadFsdf.authentication_failed,
                                            }
                                            HNvVxNmnrRJuutyjty.json(
                                              xcVXcvCXvDMn
                                            )
                                          } else {
                                            return xcVXcVcxvDMn(false)
                                          }
                                        }
                                      }
                                    )
                                  }
                                } else {
                                  if (HNvVxNmnrRJuutyjty) {
                                    var dSADsAdSaDFsdf = {
                                      status: 'error',
                                      message: bbbvcdfesdSAdsaDSadFsdf.relogin,
                                      relogin: true,
                                    }
                                    HNvVxNmnrRJuutyjty.json(dSADsAdSaDFsdf)
                                  } else {
                                    return xcVXcVcxvDMn(false)
                                  }
                                }
                              }
                            )
                          } else {
                            var XcVXCvcXvDMn =
                              "UPDATE sp_account_manager SET status = 0 WHERE token = '" +
                              DSaDsAdsaDFsdf +
                              "'"
                            bbbvcdfesxcvXcvCXvdMn.query(
                              XcVXCvcXvDMn,
                              function (dSAdSaDSaDFsdf, HNVvXnMNrRJuutyjty) {}
                            )
                            if (HNvVxNmnrRJuutyjty) {
                              var DsADSadSaDFsdf = {
                                status: 'error',
                                message:
                                  bbbvcdfesdSAdsaDSadFsdf.subscription_expired,
                              }
                              HNvVxNmnrRJuutyjty.json(DsADSadSaDFsdf)
                            } else {
                              return xcVXcVcxvDMn(false)
                            }
                            bbbvcdfesHnvvXnMNrrJuutyjty.logout(DSaDsAdsaDFsdf)
                          }
                        }
                      }
                    )
                  } else {
                    if (HNvVxNmnrRJuutyjty) {
                      var xCVxcvcXvDMn = {
                        status: 'error',
                        message: bbbvcdfesdSAdsaDSadFsdf.authentication_failed,
                      }
                      HNvVxNmnrRJuutyjty.json(xCVxcvcXvDMn)
                    } else {
                      return xcVXcVcxvDMn(false)
                    }
                  }
                }
              )
            } else {
              if (HNvVxNmnrRJuutyjty) {
                var XcVXCvCxvDMn = {
                  status: 'error',
                  message:
                    'Invalid license. Please contact the author for assistance',
                }
                HNvVxNmnrRJuutyjty.json(XcVXCvCxvDMn)
              } else {
                return xcVXcVcxvDMn(false)
              }
            }
          } catch (hnVVXnMNrRJuutyjty) {
            bbbvcdfeshNVvxnMNrrJuutyjty.debug(hnVVXnMNrRJuutyjty)
            if (HNvVxNmnrRJuutyjty) {
              var HnVVXnMnrRJuutyjty = {
                status: 'error',
                message:
                  'Invalid license. Please contact the author for assistance',
              }
              HNvVxNmnrRJuutyjty.json(HnVVXnMnrRJuutyjty)
            } else {
              return xcVXcVcxvDMn(false)
            }
          }
        } else {
          bbbvcdfesxcvXcvCXvdMn = bbbvcdfeshNVvxnMNrrJuutyjty.db_connect()
          if (HNvVxNmnrRJuutyjty) {
            var dSADSaDsaDFsdf = {
              status: 'error',
              message: 'Cannot connect to database. Please try again',
            }
            HNvVxNmnrRJuutyjty.json(dSADSaDsaDFsdf)
          } else {
            return xcVXcVcxvDMn(false)
          }
        }
      }
    )
  },
  check_instance: async function (
    XcVxcVCXvDMn,
    HnVvxNMNrRJuutyjty,
    DsAdsADSaDFsdf,
    xCVxcVCXvDMn
  ) {
    var dSAdsADSaDFsdf = __dirname + '/sessions/' + XcVxcVCXvDMn + '.json'
    if (bbbvcdfesHnVVxnMNrrJuutyjty[XcVxcVCXvDMn] == undefined) {
      if (bbbvcdfesxcvxcvCXvdMn.existsSync(dSAdsADSaDFsdf)) {
        await bbbvcdfesHnvvXnMNrrJuutyjty.session(
          XcVxcVCXvDMn,
          async (DSADsadsADFsdf) => {
            if (bbbvcdfesHnVVxnMNrrJuutyjty[XcVxcVCXvDMn]) {
              if (bbbvcdfesHnVVxnMNrrJuutyjty[XcVxcVCXvDMn].status) {
                if (DsAdsADSaDFsdf) {
                  var dsadSadsADFsdf = {
                    status: 'success',
                    message: bbbvcdfesdSAdsaDSadFsdf.success,
                  }
                  DsAdsADSaDFsdf.json(dsadSadsADFsdf)
                } else {
                  return xCVxcVCXvDMn(true)
                }
              } else {
                var xcvxCvcxVDMn = 0
                var HnvvXnmnRRJuutyjty = setInterval(function () {
                  if (bbbvcdfesHnVVxnMNrrJuutyjty[XcVxcVCXvDMn] != undefined) {
                    if (
                      bbbvcdfesHnVVxnMNrrJuutyjty[XcVxcVCXvDMn].status ||
                      xcvxCvcxVDMn > 20
                    ) {
                      clearInterval(HnvvXnmnRRJuutyjty)
                      if (bbbvcdfesHnVVxnMNrrJuutyjty[XcVxcVCXvDMn].status) {
                        if (DsAdsADSaDFsdf) {
                          var dSaDSadsADFsdf = {
                            status: 'success',
                            message: bbbvcdfesdSAdsaDSadFsdf.success,
                          }
                          DsAdsADSaDFsdf.json(dSaDSadsADFsdf)
                        } else {
                          return xCVxcVCXvDMn(true)
                        }
                      } else {
                        if (DsAdsADSaDFsdf) {
                          var XCvXCvcxVDMn = {
                            status: 'error',
                            message: bbbvcdfesdSAdsaDSadFsdf.relogin,
                          }
                          DsAdsADSaDFsdf.json(XCvXCvcxVDMn)
                        } else {
                          return xCVxcVCXvDMn(false)
                        }
                      }
                    }
                  } else {
                    if (DsAdsADSaDFsdf) {
                      var HNvVXnmnRRJuutyjty = {
                        status: 'error',
                        message: bbbvcdfesdSAdsaDSadFsdf.relogin,
                      }
                      DsAdsADSaDFsdf.json(HNvVXnmnRRJuutyjty)
                    } else {
                      return xCVxcVCXvDMn(false)
                    }
                  }
                  xcvxCvcxVDMn++
                }, 3000)
              }
            } else {
              try {
                if (bbbvcdfesxcvxcvCXvdMn.existsSync(dSAdsADSaDFsdf)) {
                  bbbvcdfesxcvxcvCXvdMn.unlinkSync(dSAdsADSaDFsdf)
                  bbbvcdfesHnVVxnMNrrJuutyjty[XcVxcVCXvDMn].logout()
                  delete bbbvcdfesXcVXcvCXvdMn[XcVxcVCXvDMn]
                  delete bbbvcdfesHnVVxnMNrrJuutyjty[XcVxcVCXvDMn]
                }
              } catch (hNvVxNmnRRJuutyjty) {}
              var DsadSadsADFsdf =
                "DELETE sp_whatsapp_sessions WHERE instance_id = '" +
                XcVxcVCXvDMn +
                "'"
              bbbvcdfesxcvXcvCXvdMn.query(
                DsadSadsADFsdf,
                function (dSaDsAdsADFsdf, xCvXcVcxVDMn) {}
              )
              var DsadSadsADFsdf =
                "UPDATE sp_account_manager SET status = 0 WHERE token = '" +
                XcVxcVCXvDMn +
                "'"
              bbbvcdfesxcvXcvCXvdMn.query(
                DsadSadsADFsdf,
                function (DSaDsAdsADFsdf, HNvVxNmnRRJuutyjty) {}
              )
              if (DsAdsADSaDFsdf) {
                var XcvxCvcxVDMn = {
                  status: 'error',
                  message: bbbvcdfesdSAdsaDSadFsdf.relogin,
                  relogin: true,
                }
                DsAdsADSaDFsdf.json(XcvxCvcxVDMn)
              } else {
                return xCVxcVCXvDMn(false)
              }
            }
          },
          false
        )
      } else {
        try {
          if (bbbvcdfesxcvxcvCXvdMn.existsSync(dSAdsADSaDFsdf)) {
            bbbvcdfesxcvxcvCXvdMn.unlinkSync(dSAdsADSaDFsdf)
            bbbvcdfesHnVVxnMNrrJuutyjty[XcVxcVCXvDMn].logout()
            delete bbbvcdfesXcVXcvCXvdMn[XcVxcVCXvDMn]
            delete bbbvcdfesHnVVxnMNrrJuutyjty[XcVxcVCXvDMn]
          }
        } catch (hNVVxNmnRRJuutyjty) {}
        var XCVxcVCXvDMn =
          "DELETE sp_whatsapp_sessions WHERE instance_id = '" +
          XcVxcVCXvDMn +
          "'"
        bbbvcdfesxcvXcvCXvdMn.query(
          XCVxcVCXvDMn,
          function (xCVXcVcxVDMn, dSADsAdsADFsdf) {}
        )
        var XCVxcVCXvDMn =
          "UPDATE sp_account_manager SET status = 0 WHERE token = '" +
          XcVxcVCXvDMn +
          "'"
        bbbvcdfesxcvXcvCXvdMn.query(
          XCVxcVCXvDMn,
          function (XCVXcVcxVDMn, HNVVxNmnRRJuutyjty) {}
        )
        if (DsAdsADSaDFsdf) {
          var HNVvxNMNrRJuutyjty = {
            status: 'error',
            message: bbbvcdfesdSAdsaDSadFsdf.relogin,
            relogin: true,
          }
          DsAdsADSaDFsdf.json(HNVvxNMNrRJuutyjty)
        } else {
          return xCVxcVCXvDMn(false)
        }
      }
    } else {
      if (
        bbbvcdfesHnVVxnMNrrJuutyjty[XcVxcVCXvDMn] != undefined &&
        bbbvcdfesHnVVxnMNrrJuutyjty[XcVxcVCXvDMn].user != undefined
      ) {
        if (DsAdsADSaDFsdf) {
          var DSAdsADSaDFsdf = {
            status: 'success',
            message: bbbvcdfesdSAdsaDSadFsdf.success,
          }
          DsAdsADSaDFsdf.json(DSAdsADSaDFsdf)
        } else {
          return xCVxcVCXvDMn(true)
        }
      } else {
        try {
          if (bbbvcdfesxcvxcvCXvdMn.existsSync(dSAdsADSaDFsdf)) {
            bbbvcdfesxcvxcvCXvdMn.unlinkSync(dSAdsADSaDFsdf)
            bbbvcdfesHnVVxnMNrrJuutyjty[XcVxcVCXvDMn].logout()
            delete bbbvcdfesHnVVxnMNrrJuutyjty[XcVxcVCXvDMn]
            delete bbbvcdfesXcVXcvCXvdMn[XcVxcVCXvDMn]
          }
        } catch (dSAdSAdsADFsdf) {}
        delete bbbvcdfesXcVXcvCXvdMn[XcVxcVCXvDMn]
        delete bbbvcdfesHnVVxnMNrrJuutyjty[XcVxcVCXvDMn]
        var XCVxcVCXvDMn =
          "DELETE sp_whatsapp_sessions WHERE instance_id = '" +
          XcVxcVCXvDMn +
          "'"
        bbbvcdfesxcvXcvCXvdMn.query(
          XCVxcVCXvDMn,
          function (hNVvXNmnRRJuutyjty, xCVxCVcxVDMn) {}
        )
        var XCVxcVCXvDMn =
          "UPDATE sp_account_manager SET status = 0 WHERE token = '" +
          XcVxcVCXvDMn +
          "'"
        bbbvcdfesxcvXcvCXvdMn.query(
          XCVxcVCXvDMn,
          function (XCVxCVcxVDMn, DSAdSAdsADFsdf) {}
        )
        if (DsAdsADSaDFsdf) {
          var hnvVxNMNrRJuutyjty = {
            status: 'error',
            message: bbbvcdfesdSAdsaDSadFsdf.relogin,
            relogin: true,
          }
          DsAdsADSaDFsdf.json(hnvVxNMNrRJuutyjty)
        } else {
          return xCVxcVCXvDMn(false)
        }
      }
    }
  },
  instance: async function (
    XcvXCVcxVDMn,
    DsaDSAdsADFsdf,
    HnvVXNmnRRJuutyjty,
    dSaDSAdsADFsdf,
    hNvVXNmnRRJuutyjty
  ) {
    if (bbbvcdfesxcVXcvCXvdMn != undefined) {
      bbbvcdfesxcVXcvCXvdMn.instance_id = XcvXCVcxVDMn
      if (!bbbvcdfesDSADsaDSadFsdf[bbbvcdfesxcVXcvCXvdMn.instance_id]) {
        bbbvcdfesDSADsaDSadFsdf[bbbvcdfesxcVXcvCXvdMn.instance_id] = new Set()
      }
      bbbvcdfesDSADsaDSadFsdf[bbbvcdfesxcVXcvCXvdMn.instance_id].add(
        bbbvcdfesxcVXcvCXvdMn
      )
      bbbvcdfesxcVXcvCXvdMn.on('disconnect', function (hnvVxNMnRRJuutyjty) {
        if (!bbbvcdfesxcVXcvCXvdMn.instance_id) {
          return
        }
        if (bbbvcdfesDSADsaDSadFsdf[bbbvcdfesxcVXcvCXvdMn.instance_id]) {
          bbbvcdfesDSADsaDSadFsdf[bbbvcdfesxcVXcvCXvdMn.instance_id].delete(
            bbbvcdfesxcVXcvCXvdMn
          )
          if (
            bbbvcdfesDSADsaDSadFsdf[bbbvcdfesxcVXcvCXvdMn.instance_id].size ===
            0
          ) {
            delete bbbvcdfesDSADsaDSadFsdf[bbbvcdfesxcVXcvCXvdMn.instance_id]
          }
        }
      })
    }
    var DSaDSAdsADFsdf = __dirname + '/sessions/' + XcvXCVcxVDMn + '.json'
    if (XcvXCVcxVDMn != undefined) {
      if (DsaDSAdsADFsdf) {
        if (bbbvcdfesHnVVxnMNrrJuutyjty[XcvXCVcxVDMn] != undefined) {
          var HNvVXNmnRRJuutyjty = bbbvcdfesHnVVxnMNrrJuutyjty[XcvXCVcxVDMn]
          if (
            bbbvcdfesXCVXcvCXvdMn[XcvXCVcxVDMn] !== undefined &&
            bbbvcdfesHnVVxnMNrrJuutyjty[XcvXCVcxVDMn] != undefined
          ) {
            return hNvVXNmnRRJuutyjty(HNvVXNmnRRJuutyjty)
          } else {
            return hNvVXNmnRRJuutyjty(false)
          }
        } else {
          await bbbvcdfesHnvvXnMNrrJuutyjty.session(
            XcvXCVcxVDMn,
            async (HnVvXNMnRRJuutyjty) => {
              bbbvcdfesdSADsaDSadFsdf[XcvXCVcxVDMn] = setInterval(function () {
                if (bbbvcdfesXCVXcvCXvdMn[XcvXCVcxVDMn] != undefined) {
                  clearInterval(bbbvcdfesdSADsaDSadFsdf[XcvXCVcxVDMn])
                  return hNvVXNmnRRJuutyjty(
                    bbbvcdfesHnVVxnMNrrJuutyjty[XcvXCVcxVDMn]
                  )
                }
              }, 1000)
            },
            true
          )
        }
      } else {
        if (
          bbbvcdfesHnVVxnMNrrJuutyjty[XcvXCVcxVDMn] != undefined &&
          !HnvVXNmnRRJuutyjty &&
          bbbvcdfesHnVVxnMNrrJuutyjty[XcvXCVcxVDMn].status
        ) {
          return hNvVXNmnRRJuutyjty(bbbvcdfesHnVVxnMNrrJuutyjty[XcvXCVcxVDMn])
        } else {
          if (bbbvcdfesxcvxcvCXvdMn.existsSync(DSaDSAdsADFsdf)) {
            await bbbvcdfesHnvvXnMNrrJuutyjty.session(
              XcvXCVcxVDMn,
              async (HNvVXNMnRRJuutyjty) => {
                if (bbbvcdfesHnVVxnMNrrJuutyjty[XcvXCVcxVDMn]) {
                  if (bbbvcdfesHnVVxnMNrrJuutyjty[XcvXCVcxVDMn].status) {
                    return hNvVXNmnRRJuutyjty(
                      bbbvcdfesHnVVxnMNrrJuutyjty[XcvXCVcxVDMn]
                    )
                  } else {
                    var dsADSADsADFsdf = 0
                    var xcVXCVCxVDMn = setInterval(function () {
                      if (
                        bbbvcdfesHnVVxnMNrrJuutyjty[XcvXCVcxVDMn] != undefined
                      ) {
                        if (
                          bbbvcdfesHnVVxnMNrrJuutyjty[XcvXCVcxVDMn].status ||
                          dsADSADsADFsdf > 20
                        ) {
                          clearInterval(xcVXCVCxVDMn)
                          if (
                            bbbvcdfesHnVVxnMNrrJuutyjty[XcvXCVcxVDMn].status
                          ) {
                            return hNvVXNmnRRJuutyjty(
                              bbbvcdfesHnVVxnMNrrJuutyjty[XcvXCVcxVDMn]
                            )
                          } else {
                            delete bbbvcdfesXcVXcvCXvdMn[XcvXCVcxVDMn]
                            delete bbbvcdfesHnVVxnMNrrJuutyjty[XcvXCVcxVDMn]
                            if (dSaDSAdsADFsdf) {
                              var XCvxcvcXVDMn = {
                                status: 'error',
                                message:
                                  bbbvcdfesdSAdsaDSadFsdf.cannot_connect_to_whatsapp,
                              }
                              dSaDSAdsADFsdf.json(XCvxcvcXVDMn)
                            } else {
                              return hNvVXNmnRRJuutyjty(false)
                            }
                          }
                        }
                      } else {
                        clearInterval(xcVXCVCxVDMn)
                        return hNvVXNmnRRJuutyjty(false)
                      }
                      dsADSADsADFsdf++
                    }, 3000)
                  }
                } else {
                  delete bbbvcdfesXcVXcvCXvdMn[XcvXCVcxVDMn]
                  delete bbbvcdfesHnVVxnMNrrJuutyjty[XcvXCVcxVDMn]
                  if (dSaDSAdsADFsdf) {
                    var DsADSADsADFsdf = {
                      status: 'error',
                      message:
                        bbbvcdfesdSAdsaDSadFsdf.cannot_connect_to_whatsapp,
                    }
                    dSaDSAdsADFsdf.json(DsADSADsADFsdf)
                  } else {
                    return hNvVXNmnRRJuutyjty(false)
                  }
                }
              },
              false
            )
          } else {
            try {
              if (bbbvcdfesxcvxcvCXvdMn.existsSync(DSaDSAdsADFsdf)) {
                bbbvcdfesxcvxcvCXvdMn.unlinkSync(DSaDSAdsADFsdf)
                bbbvcdfesHnVVxnMNrrJuutyjty[XcvXCVcxVDMn].logout()
                delete bbbvcdfesXcVXcvCXvdMn[XcvXCVcxVDMn]
                delete bbbvcdfesHnVVxnMNrrJuutyjty[XcvXCVcxVDMn]
              }
            } catch (XcVxCvcXVDMn) {}
            var XCvXCVcxVDMn =
              "DELETE sp_whatsapp_sessions WHERE instance_id = '" +
              XcvXCVcxVDMn +
              "'"
            bbbvcdfesxcvXcvCXvdMn.query(
              XCvXCVcxVDMn,
              function (dSAdSadSADFsdf, xCVxCvcXVDMn) {}
            )
            var XCvXCVcxVDMn =
              "UPDATE sp_account_manager SET status = 0 WHERE token = '" +
              XcvXCVcxVDMn +
              "'"
            bbbvcdfesxcvXcvCXvdMn.query(
              XCvXCVcxVDMn,
              function (hNVvXnmNRRJuutyjty, DSAdSadSADFsdf) {}
            )
            if (dSaDSAdsADFsdf) {
              var dsADSAdsADFsdf = {
                status: 'error',
                message: bbbvcdfesdSAdsaDSadFsdf.relogin,
                relogin: true,
              }
              dSaDSAdsADFsdf.json(dsADSAdsADFsdf)
            } else {
              return hNvVXNmnRRJuutyjty(false)
            }
          }
        }
      }
    } else {
      if (dSaDSAdsADFsdf) {
        var xcVXCVcxVDMn = {
          status: 'error',
          message: bbbvcdfesdSAdsaDSadFsdf.instance_id_invalidated,
        }
        dSaDSAdsADFsdf.json(xcVXCVcxVDMn)
      } else {
        return hNvVXNmnRRJuutyjty(false)
      }
    }
  },
  logout: async function (xcVXCvcXVDMn, dsADSadSADFsdf) {
    var XcVXCvcXVDMn = __dirname + '/sessions/' + xcVXCvcXVDMn + '.json'
    if (bbbvcdfesxcvxcvCXvdMn.existsSync(XcVXCvcXVDMn)) {
      bbbvcdfesxcvxcvCXvdMn.unlinkSync(XcVXCvcXVDMn)
      var DsADSadSADFsdf = bbbvcdfesHnVVxnMNrrJuutyjty[xcVXCvcXVDMn]
      try {
        DsADSadSADFsdf.logout().then(async () => {
          try {
            if (bbbvcdfesxcvxcvCXvdMn.existsSync(XcVXCvcXVDMn)) {
              bbbvcdfesxcvxcvCXvdMn.unlinkSync(XcVXCvcXVDMn)
              delete bbbvcdfesXcVXcvCXvdMn[xcVXCvcXVDMn]
              delete bbbvcdfesHnVVxnMNrrJuutyjty[xcVXCvcXVDMn]
            }
          } catch (XcvxCVcXVDMn) {}
          var HnVVxNmNRRJuutyjty =
            "DELETE sp_whatsapp_sessions WHERE instance_id = '" +
            xcVXCvcXVDMn +
            "'"
          bbbvcdfesxcvXcvCXvdMn.query(
            HnVVxNmNRRJuutyjty,
            function (DsadSAdSADFsdf, HnvvXNmNRRJuutyjty) {}
          )
          var HnVVxNmNRRJuutyjty =
            "UPDATE sp_account_manager SET status = 0 WHERE token = '" +
            xcVXCvcXVDMn +
            "'"
          bbbvcdfesxcvXcvCXvdMn.query(
            HnVVxNmNRRJuutyjty,
            function (xCvxCVcXVDMn, dSadSAdSADFsdf) {}
          )
          delete bbbvcdfesHnVVxnMNrrJuutyjty[xcVXCvcXVDMn]
          delete bbbvcdfesXcVXcvCXvdMn[xcVXCvcXVDMn]
          if (dsADSadSADFsdf != undefined) {
            var XcVXcVcXVDMn = {
              status: 'success',
              message: bbbvcdfesdSAdsaDSadFsdf.success,
            }
            dsADSadSADFsdf.json(XcVXcVcXVDMn)
          }
        })
      } catch (dsAdSAdSADFsdf) {
        try {
          var xCVXCvcXVDMn =
            "DELETE sp_whatsapp_sessions WHERE instance_id = '" +
            xcVXCvcXVDMn +
            "'"
          bbbvcdfesxcvXcvCXvdMn.query(
            xCVXCvcXVDMn,
            function (hnVvXNmNRRJuutyjty, DsAdSAdSADFsdf) {}
          )
          var xCVXCvcXVDMn =
            "UPDATE sp_account_manager SET status = 0 WHERE token = '" +
            xcVXCvcXVDMn +
            "'"
          bbbvcdfesxcvXcvCXvdMn.query(
            xCVXCvcXVDMn,
            function (HnVvXNmNRRJuutyjty, XcVxCVcXVDMn) {}
          )
          try {
            if (bbbvcdfesxcvxcvCXvdMn.existsSync(XcVXCvcXVDMn)) {
              bbbvcdfesxcvxcvCXvdMn.unlinkSync(XcVXCvcXVDMn)
              delete bbbvcdfesXcVXcvCXvdMn[xcVXCvcXVDMn]
              delete bbbvcdfesHnVVxnMNrrJuutyjty[xcVXCvcXVDMn]
              if (dsADSadSADFsdf != undefined) {
                var dSADSadSADFsdf = {
                  status: 'success',
                  message: bbbvcdfesdSAdsaDSadFsdf.success,
                }
                dsADSadSADFsdf.json(dSADSadSADFsdf)
              }
            }
          } catch (HNVvXNmNRRJuutyjty) {}
        } catch (DsaDSAdSADFsdf) {
          delete bbbvcdfesXcVXcvCXvdMn[xcVXCvcXVDMn]
          delete bbbvcdfesHnVVxnMNrrJuutyjty[xcVXCvcXVDMn]
          if (dsADSadSADFsdf != undefined) {
            var hNVVXnmNRRJuutyjty = {
              status: 'error',
              message: bbbvcdfesdSAdsaDSadFsdf.logout_failed,
            }
            dsADSadSADFsdf.json(hNVVXnmNRRJuutyjty)
          }
        }
      }
    } else {
      if (dsADSadSADFsdf != undefined) {
        var DSADSadSADFsdf = {
          status: 'error',
          message: bbbvcdfesdSAdsaDSadFsdf.logout_failed,
        }
        dsADSadSADFsdf.json(DSADSadSADFsdf)
      }
    }
  },
  get_info: async function (hNVVXNmNRRJuutyjty, xCVXCVcXVDMn) {
    if (
      hNVVXNmNRRJuutyjty != undefined &&
      hNVVXNmNRRJuutyjty.user != undefined
    ) {
      try {
        const hNVvxnMNRRJuutyjty = await hNVVXNmNRRJuutyjty.profilePictureUrl(
          hNVVXNmNRRJuutyjty.user.id
        )
        hNVVXNmNRRJuutyjty.user.avatar = hNVvxnMNRRJuutyjty
      } catch (XCVxcvCXVDMn) {
        hNVVXNmNRRJuutyjty.user.avatar =
          'https://ui-avatars.com/api?name=' +
          bbbvcdfeshNVvxnMNrrJuutyjty.get_phone(hNVVXNmNRRJuutyjty.user.id) +
          '&size=128&background=25D366&color=fff&format=png'
      }
      var DSADSAdSADFsdf = {
        status: 'success',
        message: bbbvcdfesdSAdsaDSadFsdf.success,
        data: hNVVXNmNRRJuutyjty.user,
      }
      xCVXCVcXVDMn.json(DSADSAdSADFsdf)
    } else {
      var XCVXCVcXVDMn = {
        status: 'error',
        message: bbbvcdfesdSAdsaDSadFsdf.relogin,
        relogin: true,
      }
      xCVXCVcXVDMn.json(XCVXCVcXVDMn)
    }
  },
  get_qrcode: async function (
    dsaDsaDSADFsdf,
    HnvVxnMNRRJuutyjty,
    DsaDsaDSADFsdf
  ) {
    if (
      bbbvcdfesHnVVxnMNrrJuutyjty[dsaDsaDSADFsdf] != undefined &&
      bbbvcdfesXCVXcvCXvdMn[dsaDsaDSADFsdf] !== undefined
    ) {
      setTimeout(function () {
        if (
          bbbvcdfesHnVVxnMNrrJuutyjty[dsaDsaDSADFsdf] != undefined &&
          bbbvcdfesHnVVxnMNrrJuutyjty[dsaDsaDSADFsdf].user == undefined
        ) {
          delete bbbvcdfesXCVXcvCXvdMn[dsaDsaDSADFsdf]
          delete bbbvcdfesHnVVxnMNrrJuutyjty[dsaDsaDSADFsdf]
          delete bbbvcdfesXcVXcvCXvdMn[dsaDsaDSADFsdf]
        }
      }, 60000)
      var dSaDsaDSADFsdf = { type: 'png' }
      var xCvXcvCXVDMn = bbbvcdfesHnvvxnMNrrJuutyjty.imageSync(
        bbbvcdfesXCVXcvCXvdMn[dsaDsaDSADFsdf],
        dSaDsaDSADFsdf
      )
      HnvVxnMNRRJuutyjty.json({
        status: 'success',
        message: 'Success',
        base64: 'data:image/png;base64,' + xCvXcvCXVDMn.toString('base64'),
      })
    } else {
      var hNvVxnMNRRJuutyjty = {
        status: 'error',
        message: bbbvcdfesdSAdsaDSadFsdf.cannot_get_qrcode,
      }
      HnvVxnMNRRJuutyjty.json(hNvVxnMNRRJuutyjty)
    }
  },
  get_groups: async function (
    HnvVXnMNRRJuutyjty,
    dSaDSaDSADFsdf,
    hNvVXnMNRRJuutyjty
  ) {
    if (HnvVXnMNRRJuutyjty) {
      var XCvXCvCXVDMn = []
      if (bbbvcdfesxCVXcvCXvdMn[dSaDSaDSADFsdf] != undefined) {
        await HnvVXnMNRRJuutyjty.groupMetadata(
          bbbvcdfesxCVXcvCXvdMn[dSaDSaDSADFsdf].remoteJid
        )
          .then(async (xCvxcVCXVDMn) => {
            XCvXCvCXVDMn.push(xCvxcVCXVDMn)
            var dSadsADSADFsdf = {
              status: 'success',
              message: bbbvcdfesdSAdsaDSadFsdf.success,
              data: XCvXCvCXVDMn,
            }
            hNvVXnMNRRJuutyjty.json(dSadsADSADFsdf)
          })
          .catch((XCvxcVCXVDMn) => {
            bbbvcdfeshNVvxnMNrrJuutyjty.debug(XCvxcVCXVDMn)
            var DSadsADSADFsdf = {
              status: 'error',
              message: bbbvcdfesdSAdsaDSadFsdf.cannot_get_participants,
            }
            hNvVXnMNRRJuutyjty.json(DSadsADSADFsdf)
          })
      } else {
        var DSaDSaDSADFsdf = {
          status: 'success',
          message: bbbvcdfesdSAdsaDSadFsdf.success,
          data: [],
        }
        hNvVXnMNRRJuutyjty.json(DSaDSaDSADFsdf)
      }
    } else {
      var HNvVXnMNRRJuutyjty = {
        status: 'error',
        message: bbbvcdfesdSAdsaDSadFsdf.relogin,
        relogin: true,
      }
      hNvVXnMNRRJuutyjty.json(HNvVXnMNRRJuutyjty)
    }
  },
  get_group_participants: async function (
    XcVxcVCXVDMn,
    hNVvxNMNRRJuutyjty,
    dSAdsADSADFsdf
  ) {
    if (XcVxcVCXVDMn) {
      await XcVxcVCXVDMn.groupMetadata(hNVvxNMNRRJuutyjty)
        .then(async (HnVVxNMNRRJuutyjty) => {
          var XcVXcVCXVDMn = {
            status: 'success',
            message: bbbvcdfesdSAdsaDSadFsdf.success,
            data: HnVVxNMNRRJuutyjty.participants,
          }
          dSAdsADSADFsdf.json(XcVXcVCXVDMn)
        })
        .catch((dSADsADSADFsdf) => {
          bbbvcdfeshNVvxnMNrrJuutyjty.debug(dSADsADSADFsdf)
          var hNVVxNMNRRJuutyjty = {
            status: 'error',
            message: bbbvcdfesdSAdsaDSadFsdf.cannot_get_participants,
          }
          dSAdsADSADFsdf.json(hNVVxNMNRRJuutyjty)
        })
    } else {
      var XCVxcVCXVDMn = {
        status: 'error',
        message: bbbvcdfesdSAdsaDSadFsdf.relogin,
        relogin: true,
      }
      dSAdsADSADFsdf.json(XCVxcVCXVDMn)
    }
  },
  update_message_sent_per_day: async function (
    DsAdSADSADFsdf,
    HnVvXNMNRRJuutyjty,
    hNVvXNMNRRJuutyjty,
    xCVxCVCXVDMn
  ) {
    if (typeof bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf] !== 'undefined') {
      if (
        bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].wa_message_sent_today <
        bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].message_per_day
      ) {
        switch (HnVvXNMNRRJuutyjty) {
          case 'chatbot':
            bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].wa_message_sent_today += 1
            var DSAdSADSADFsdf =
              bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].instance_ids.indexOf(
                hNVvXNMNRRJuutyjty
              )
            var XCVxCVCXVDMn =
              bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].stats[
                DSAdSADSADFsdf
              ].chatbot_ids.indexOf(xCVxCVCXVDMn)
            bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].wa_chatbot_count += 1
            if (DSAdSADSADFsdf !== -1 && XCVxCVCXVDMn === -1) {
              var HNVvXNMNRRJuutyjty = await new Promise(
                async (XCvxCvcxvdmN, dsAdSadsadfSdf) => {
                  bbbvcdfesxcvXcvCXvdMn.query(
                    "SELECT * from sp_whatsapp_chatbot WHERE id = '" +
                      xCVxCVCXVDMn +
                      "'",
                    (dSAdSadsadfSdf, hNVvXnmnrrjUutyjty) => {
                      return XCvxCvcxvdmN(hNVvXnmnrrjUutyjty)
                    }
                  )
                }
              )
              if (
                HNVvXNMNRRJuutyjty != undefined &&
                HNVvXNMNRRJuutyjty.length > 0
              ) {
                bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].stats[
                  DSAdSADSADFsdf
                ].chatbot_ids.push(xCVxCVCXVDMn)
                bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].stats[
                  DSAdSADSADFsdf
                ].chatbot_counts.push(HNVvXNMNRRJuutyjty[0].sent)
              }
            }
            XCVxCVCXVDMn =
              bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].stats[
                DSAdSADSADFsdf
              ].chatbot_ids.indexOf(xCVxCVCXVDMn)
            if (DSAdSADSADFsdf !== -1 && XCVxCVCXVDMn !== -1) {
              bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].stats[
                DSAdSADSADFsdf
              ].chatbot_counts[XCVxCVCXVDMn] += 1
            }
            break
          case 'autoresponder':
            var DSAdSADSADFsdf =
              bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].instance_ids.indexOf(
                hNVvXNMNRRJuutyjty
              )
            bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].wa_message_sent_today += 1
            bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].wa_autoresponder_count += 1
            bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].stats[
              DSAdSADSADFsdf
            ].autoresponder_count += 1
            break
          case 'bulk':
            bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].wa_bulk_total_count += 1
            if (xCVxCVCXVDMn) {
              bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].wa_message_sent_today += 1
              bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].wa_bulk_sent_count += 1
            } else {
              bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].wa_bulk_failed_count += 1
            }
            break
          case 'chat':
            var DSAdSADSADFsdf =
              bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].instance_ids.indexOf(
                hNVvXNMNRRJuutyjty
              )
            bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].wa_message_sent_today += 1
            bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].wa_chat_count += 1
            break
          default:
            bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].wa_message_sent_today += 1
            break
        }
        if (bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].instance_ids.length > 0) {
          for (
            var hnvVXNMNRRJuutyjty = 0;
            hnvVXNMNRRJuutyjty <
            bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].instance_ids.length;
            hnvVXNMNRRJuutyjty++
          ) {
            var xcvXCVCXVDMn =
              bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].instance_ids[
                hnvVXNMNRRJuutyjty
              ]
            var dsaDSADSADFsdf = {
              sent: bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].stats[
                hnvVXNMNRRJuutyjty
              ].autoresponder_count,
            }
            var XcvXCVCXVDMn = dsaDSADSADFsdf
            var HnvVXNMNRRJuutyjty =
              "UPDATE sp_whatsapp_autoresponder SET ? WHERE instance_id = '" +
              xcvXCVCXVDMn +
              "'"
            bbbvcdfesxcvXcvCXvdMn.query(
              HnvVXNMNRRJuutyjty,
              XcvXCVCXVDMn,
              function (HNVVXnmnrrjUutyjty, DSADSadsadfSdf) {}
            )
          }
        }
        if (bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].instance_ids.length > 0) {
          for (
            var hnvVXNMNRRJuutyjty = 0;
            hnvVXNMNRRJuutyjty <
            bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].instance_ids.length;
            hnvVXNMNRRJuutyjty++
          ) {
            var xcvXCVCXVDMn =
              bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].instance_ids[
                hnvVXNMNRRJuutyjty
              ]
            if (
              bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].stats[hnvVXNMNRRJuutyjty]
                .chatbot_ids.length > 0
            ) {
              var DsaDSADSADFsdf =
                bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].stats[
                  hnvVXNMNRRJuutyjty
                ].chatbot_ids
              for (
                var hNvVXNMNRRJuutyjty = 0;
                hNvVXNMNRRJuutyjty < DsaDSADSADFsdf.length;
                hNvVXNMNRRJuutyjty++
              ) {
                var HNvVXNMNRRJuutyjty =
                  bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].stats[
                    hnvVXNMNRRJuutyjty
                  ].chatbot_ids[hNvVXNMNRRJuutyjty]
                var xcVXCVCXVDMn =
                  bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].stats[
                    hnvVXNMNRRJuutyjty
                  ].chatbot_counts[hNvVXNMNRRJuutyjty]
                var XCvXCVCXVDMn = { sent: xcVXCVCXVDMn }
                var DSaDSADSADFsdf = XCvXCVCXVDMn
                var dsADSADSADFsdf =
                  "UPDATE sp_whatsapp_chatbot SET ? WHERE id = '" +
                  HNvVXNMNRRJuutyjty +
                  "'"
                bbbvcdfesxcvXcvCXvdMn.query(
                  dsADSADSADFsdf,
                  DSaDSADSADFsdf,
                  function (DsadsAdsadfSdf, HnvvxNmnrrjUutyjty) {}
                )
              }
            }
          }
        }
        var hnVVXNMNRRJuutyjty = {
          wa_message_sent_today:
            bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].wa_message_sent_today,
          wa_chat_count: bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].wa_chat_count,
          wa_chatbot_count:
            bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].wa_chatbot_count,
          wa_autoresponder_count:
            bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].wa_autoresponder_count,
          wa_bulk_sent_count:
            bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].wa_bulk_sent_count,
          wa_bulk_failed_count:
            bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].wa_bulk_failed_count,
          wa_bulk_total_count:
            bbbvcdfesdsadSaDSadFsdf[DsAdSADSADFsdf].wa_bulk_total_count,
        }
        var DsADSADSADFsdf = hnVVXNMNRRJuutyjty
        var XcVXCVCXVDMn =
          "UPDATE sp_whatsapp_stats SET ? WHERE team_id = '" +
          DsAdSADSADFsdf +
          "'"
        bbbvcdfesxcvXcvCXvdMn.query(
          XcVXCVCXVDMn,
          DsADSADSADFsdf,
          function (dSadsAdsadfSdf, XCvxcVcxvdmN) {}
        )
      }
    }
  },
  send_message: async function (
    xcVxcVcxvdmN,
    dsAdsAdsadfSdf,
    DsAdsAdsadfSdf,
    XcVxcVcxvdmN
  ) {
    if (
      bbbvcdfesxcvXcvCXvdMn.state != undefined &&
      bbbvcdfesxcvXcvCXvdMn.state == 'disconnected'
    ) {
      bbbvcdfesxcvXcvCXvdMn = bbbvcdfeshNVvxnMNrrJuutyjty.db_connect()
    }
    var dSAdsAdsadfSdf = DsAdsAdsadfSdf.query.type
    if (dSAdsAdsadfSdf == 'media') {
      var xCVxcVcxvdmN = bbbvcdfesxCvxcvCXvdMn(
        bbbvcdfeshNVvxnMNrrJuutyjty.now()
      )
      var hNVvxNmnrrjUutyjty = DsAdsAdsadfSdf.body.chat_id
      var XCVxcVcxvdmN = DsAdsAdsadfSdf.body.body
      var DSAdsAdsadfSdf = DsAdsAdsadfSdf.body.caption
      var HNVvxNmnrrjUutyjty = DsAdsAdsadfSdf.body.filename
      const xcvxCVcxvdmN = Buffer.from(
        XCVxcVcxvdmN.substring(XCVxcVcxvdmN.indexOf(',') + 1)
      )
      var xcvXcVcxvdmN =
        bbbvcdfeshNVvxnMNrrJuutyjty.mimetype_from_extension(XCVxcVcxvdmN)
      var hnvVxNmnrrjUutyjty = bbbvcdfeshNVvxnMNrrJuutyjty.post_type(
        xcvXcVcxvdmN,
        1
      )
      switch (hnvVxNmnrrjUutyjty) {
        case 'videoMessage':
          var dsaDsAdsadfSdf = { url: XCVxcVcxvdmN }
          var HnvVxNmnrrjUutyjty = {
            video: dsaDsAdsadfSdf,
            caption: bbbvcdfesDSadsaDSadFsdf.unspin(DSAdsAdsadfSdf),
          }
          break
        case 'imageMessage':
          var XcvXcVcxvdmN = { url: XCVxcVcxvdmN }
          var HnvVxNmnrrjUutyjty = {
            image: XcvXcVcxvdmN,
            caption: bbbvcdfesDSadsaDSadFsdf.unspin(DSAdsAdsadfSdf),
          }
          break
        case 'audioMessage':
          var DsaDsAdsadfSdf = { url: XCVxcVcxvdmN }
          var hNvVxNmnrrjUutyjty = { audio: DsaDsAdsadfSdf }
          var HnvVxNmnrrjUutyjty = hNvVxNmnrrjUutyjty
          break
        default:
          var xCvXcVcxvdmN = { url: XCVxcVcxvdmN }
          var HnvVxNmnrrjUutyjty = {
            document: xCvXcVcxvdmN,
            fileName: HNVvxNmnrrjUutyjty,
            caption: bbbvcdfesDSadsaDSadFsdf.unspin(DSAdsAdsadfSdf),
          }
          break
      }
      xcVxcVcxvdmN
        .sendMessage(hNVvxNmnrrjUutyjty, HnvVxNmnrrjUutyjty)
        .then(async (dsadSAdsadfSdf) => {
          bbbvcdfesHnvvXnMNrrJuutyjty.update_message_sent_per_day(
            dsAdsAdsadfSdf,
            'chat'
          )
          var DsadSAdsadfSdf = {
            status: 'success',
            message: bbbvcdfesdSAdsaDSadFsdf.success,
            data: dsadSAdsadfSdf,
          }
          XcVxcVcxvdmN.json(DsadSAdsadfSdf)
        })
        .catch((xCvxCVcxvdmN) => {
          bbbvcdfeshNVvxnMNrrJuutyjty.debug(xCvxCVcxvdmN)
          var DSadSAdsadfSdf = {
            status: 'error',
            message: bbbvcdfesdSAdsaDSadFsdf.send_message_error,
          }
          XcVxcVcxvdmN.json(DSadSAdsadfSdf)
        })
    } else {
      var hNVvxNmnrrjUutyjty = DsAdsAdsadfSdf.body.chat_id
      var dSaDsAdsadfSdf = DsAdsAdsadfSdf.body.body
      xcVxcVcxvdmN
        .sendMessage(hNVvxNmnrrjUutyjty, {
          text: bbbvcdfesDSadsaDSadFsdf.unspin(dSaDsAdsadfSdf),
        })
        .then((xcVxCVcxvdmN) => {
          bbbvcdfesHnvvXnMNrrJuutyjty.update_message_sent_per_day(
            dsAdsAdsadfSdf,
            'chat'
          )
          var hnVvXNmnrrjUutyjty = {
            status: 'success',
            message: bbbvcdfesdSAdsaDSadFsdf.success,
            data: xcVxCVcxvdmN,
          }
          XcVxcVcxvdmN.json(hnVvXNmnrrjUutyjty)
        })
        .catch((XcVxCVcxvdmN) => {
          bbbvcdfeshNVvxnMNrrJuutyjty.debug(XcVxCVcxvdmN)
          var HnVvXNmnrrjUutyjty = {
            status: 'error',
            message: bbbvcdfesdSAdsaDSadFsdf.send_message_error,
          }
          XcVxcVcxvdmN.json(HnVvXNmnrrjUutyjty)
        })
    }
  },
  autoresponder: async function (
    dSAdSAdsadfSdf,
    hNVvXNmnrrjUutyjty,
    xCVxCVcxvdmN,
    HNVvXNmnrrjUutyjty
  ) {
    if (
      HNVvXNmnrrjUutyjty.key.fromMe === false &&
      dSAdSAdsadfSdf != undefined &&
      HNVvXNmnrrjUutyjty.key.remoteJid != 'status@broadcast'
    ) {
      bbbvcdfeshNVvxnMNrrJuutyjty.debug('Auto response')
      var DSAdSAdsadfSdf = new Date().getTime() / 1000
      var xcvXCVcxvdmN =
        "SELECT * from sp_whatsapp_autoresponder WHERE instance_id = '" +
        hNVvXNmnrrjUutyjty +
        "' AND status = 1"
      bbbvcdfesxcvXcvCXvdMn.query(
        xcvXCVcxvdmN,
        function (dsaDsaDsadfSdf, hnvVxnMnrrjUutyjty) {
          if (
            hnvVxnMnrrjUutyjty != undefined &&
            hnvVxnMnrrjUutyjty.length > 0
          ) {
            hnvVxnMnrrjUutyjty = hnvVxnMnrrjUutyjty[0]
            if (
              bbbvcdfesXcVXcvCXvdMn[hNVvXNmnrrjUutyjty][
                HNVvXNmnrrjUutyjty.key.remoteJid
              ] == undefined ||
              bbbvcdfesXcVXcvCXvdMn[hNVvXNmnrrjUutyjty][
                HNVvXNmnrrjUutyjty.key.remoteJid
              ] +
                hnvVxnMnrrjUutyjty.delay * 60 <
                DSAdSAdsadfSdf
            ) {
              bbbvcdfesXcVXcvCXvdMn[hNVvXNmnrrjUutyjty][
                HNVvXNmnrrjUutyjty.key.remoteJid
              ] = HNVvXNmnrrjUutyjty.messageTimestamp
              if (hnvVxnMnrrjUutyjty.send_to == 2) {
                if (xCVxCVcxvdmN.indexOf('g.us') !== -1) {
                  return false
                }
              } else {
                if (hnvVxnMnrrjUutyjty.send_to == 3) {
                  if (xCVxCVcxvdmN.indexOf('s.whatsapp.net') !== -1) {
                    return false
                  }
                }
              }
              var DsaDsaDsadfSdf =
                "SELECT * FROM sp_team WHERE id = '" +
                hnvVxnMnrrjUutyjty.team_id +
                "' "
              bbbvcdfesxcvXcvCXvdMn.query(
                DsaDsaDsadfSdf,
                function (XcvXcvCxvdmN, hNvVxnMnrrjUutyjty) {
                  if (
                    hNvVxnMnrrjUutyjty != undefined &&
                    hNvVxnMnrrjUutyjty.length > 0
                  ) {
                    var hnVVxnMnrrjUutyjty = hNvVxnMnrrjUutyjty[0].ids
                    var dsADsaDsadfSdf = new Date(
                      bbbvcdfeshNVvxnMNrrJuutyjty.now(2)
                    ).getTime()
                    if (
                      typeof bbbvcdfesdsadSaDSadFsdf[hnVVxnMnrrjUutyjty] ==
                      'undefined'
                    ) {
                      return false
                    }
                    if (
                      typeof bbbvcdfesdsadSaDSadFsdf[hnVVxnMnrrjUutyjty]
                        .expiration_date == 'undefined' ||
                      dsADsaDsadfSdf >=
                        bbbvcdfesdsadSaDSadFsdf[hnVVxnMnrrjUutyjty]
                          .expiration_date
                    ) {
                      return false
                    }
                    if (
                      typeof bbbvcdfesdsadSaDSadFsdf[hnVVxnMnrrjUutyjty]
                        .wa_message_sent_today == 'undefined' ||
                      bbbvcdfesdsadSaDSadFsdf[hnVVxnMnrrjUutyjty]
                        .wa_message_sent_today >=
                        bbbvcdfesdsadSaDSadFsdf[hnVVxnMnrrjUutyjty]
                          .message_per_day
                    ) {
                      return false
                    }
                    var DSaDsaDsadfSdf = []
                    var XcVXcvCxvdmN = hnvVxnMnrrjUutyjty.except
                    if (XcVXcvCxvdmN != null) {
                      var XCvXcvCxvdmN = JSON.parse(XcVXcvCxvdmN)
                      if (XCvXcvCxvdmN.length > 0) {
                        for (
                          var HNvVxnMnrrjUutyjty = 0;
                          HNvVxnMnrrjUutyjty < XCvXcvCxvdmN.length;
                          HNvVxnMnrrjUutyjty++
                        ) {
                          DSaDsaDsadfSdf.push(XCvXcvCxvdmN[HNvVxnMnrrjUutyjty])
                        }
                      }
                    }
                    if (DSaDsaDsadfSdf.length > 0) {
                      for (
                        var HNvVxnMnrrjUutyjty = 0;
                        HNvVxnMnrrjUutyjty < DSaDsaDsadfSdf.length;
                        HNvVxnMnrrjUutyjty++
                      ) {
                        if (
                          xCVxCVcxvdmN.search(
                            DSaDsaDsadfSdf[HNvVxnMnrrjUutyjty]
                          ) != -1
                        ) {
                          return false
                        }
                      }
                    }
                    var xcVXcvCxvdmN = hnvVxnMnrrjUutyjty.data
                    bbbvcdfesHnvvXnMNrrJuutyjty.send_auto_proccess(
                      dSAdSAdsadfSdf,
                      hNVvXNmnrrjUutyjty,
                      hnVVxnMnrrjUutyjty,
                      xCVxCVcxvdmN,
                      'autoresponder',
                      hnvVxnMnrrjUutyjty,
                      xcVXcvCxvdmN
                    )
                    return false
                  }
                }
              )
            } else {
              bbbvcdfesXcVXcvCXvdMn[hNVvXNmnrrjUutyjty][
                HNVvXNmnrrjUutyjty.key.remoteJid
              ] = HNVvXNmnrrjUutyjty.messageTimestamp
            }
          } else {
            bbbvcdfesXcVXcvCXvdMn[hNVvXNmnrrjUutyjty][
              HNVvXNmnrrjUutyjty.key.remoteJid
            ] = HNVvXNmnrrjUutyjty.messageTimestamp
          }
        }
      )
    }
  },
  chatbot: function (
    DsADsaDsadfSdf,
    HnVVxnMnrrjUutyjty,
    dSADsaDsadfSdf,
    hNVVxnMnrrjUutyjty
  ) {
    if (
      hNVVxnMnrrjUutyjty.key.fromMe === false &&
      DsADsaDsadfSdf != undefined
    ) {
      bbbvcdfeshNVvxnMNrrJuutyjty.debug('Chatbot')
      var DSADsaDsadfSdf = hNVVxnMnrrjUutyjty
      var XCVXcvCxvdmN =
        "SELECT * from sp_whatsapp_chatbot WHERE instance_id = '" +
        HnVVxnMnrrjUutyjty +
        "' AND status = 1 AND run = 1"
      bbbvcdfesxcvXcvCXvdMn.query(
        XCVXcvCxvdmN,
        function (XcvxcVCxvdmN, DsadsADsadfSdf) {
          if (DsadsADsadfSdf != undefined && DsadsADsadfSdf.length > 0) {
            var hNvvxNMnrrjUutyjty =
              "SELECT * FROM sp_team WHERE id = '" +
              DsadsADsadfSdf[0].team_id +
              "' "
            bbbvcdfesxcvXcvCXvdMn.query(
              hNvvxNMnrrjUutyjty,
              function (dSadsADsadfSdf, xCvxcVCxvdmN) {
                if (xCvxcVCxvdmN != undefined && xCvxcVCxvdmN.length > 0) {
                  var xcVxcVCxvdmN = xCvxcVCxvdmN[0].ids
                  var dsAdsADsadfSdf = new Date(
                    bbbvcdfeshNVvxnMNrrJuutyjty.now(2)
                  ).getTime()
                  if (
                    typeof bbbvcdfesdsadSaDSadFsdf[xcVxcVCxvdmN] == 'undefined'
                  ) {
                    return false
                  }
                  if (
                    typeof bbbvcdfesdsadSaDSadFsdf[xcVxcVCxvdmN]
                      .expiration_date == 'undefined' ||
                    dsAdsADsadfSdf >=
                      bbbvcdfesdsadSaDSadFsdf[xcVxcVCxvdmN].expiration_date
                  ) {
                    return false
                  }
                  if (
                    typeof bbbvcdfesdsadSaDSadFsdf[xcVxcVCxvdmN]
                      .wa_message_sent_today == 'undefined' ||
                    bbbvcdfesdsadSaDSadFsdf[xcVxcVCxvdmN]
                      .wa_message_sent_today >=
                      bbbvcdfesdsadSaDSadFsdf[xcVxcVCxvdmN].message_per_day
                  ) {
                    return false
                  }
                  if (
                    typeof DSADsaDsadfSdf != 'undefined' &&
                    typeof DSADsaDsadfSdf.message != 'undefined'
                  ) {
                    DsadsADsadfSdf.forEach((DSADsADsadfSdf) => {
                      var DsadSADsadfSdf = DSADsADsadfSdf.caption
                      var xCvxCVCxvdmN = DSADsADsadfSdf.keywords.split(',')
                      var xcvxCVCxvdmN = false
                      if (
                        DSADsaDsadfSdf.message.templateButtonReplyMessage !=
                        undefined
                      ) {
                        xcvxCVCxvdmN =
                          DSADsaDsadfSdf.message.templateButtonReplyMessage
                            .selectedDisplayText
                      } else {
                        if (
                          DSADsaDsadfSdf.message.listResponseMessage !=
                          undefined
                        ) {
                          xcvxCVCxvdmN =
                            DSADsaDsadfSdf.message.listResponseMessage.title +
                            DSADsaDsadfSdf.message.listResponseMessage
                              .description
                        } else {
                          if (
                            typeof DSADsaDsadfSdf.message.extendedTextMessage !=
                              'undefined' &&
                            DSADsaDsadfSdf.message.extendedTextMessage != null
                          ) {
                            xcvxCVCxvdmN =
                              DSADsaDsadfSdf.message.extendedTextMessage.text
                          } else {
                            if (
                              typeof DSADsaDsadfSdf.message.imageMessage !=
                                'undefined' &&
                              DSADsaDsadfSdf.message.imageMessage != null
                            ) {
                              xcvxCVCxvdmN =
                                DSADsaDsadfSdf.message.imageMessage.caption
                            } else {
                              if (
                                typeof DSADsaDsadfSdf.message.videoMessage !=
                                  'undefined' &&
                                DSADsaDsadfSdf.message.videoMessage != null
                              ) {
                                xcvxCVCxvdmN =
                                  DSADsaDsadfSdf.message.videoMessage.caption
                              } else {
                                if (
                                  typeof DSADsaDsadfSdf.message.conversation !=
                                  'undefined'
                                ) {
                                  xcvxCVCxvdmN =
                                    DSADsaDsadfSdf.message.conversation
                                }
                              }
                            }
                          }
                        }
                      }
                      var dsadSADsadfSdf = true
                      if (DSADsADsadfSdf.send_to == 2) {
                        if (dSADsaDsadfSdf.indexOf('g.us') !== -1) {
                          dsadSADsadfSdf = false
                        }
                      } else {
                        if (DSADsADsadfSdf.send_to == 3) {
                          if (dSADsaDsadfSdf.indexOf('s.whatsapp.net') !== -1) {
                            dsadSADsadfSdf = false
                          }
                        }
                      }
                      if (
                        bbbvcdfesDsADsaDSadFsdf ==
                        DSADsADsadfSdf.id + '-' + DSADsaDsadfSdf.key.id
                      ) {
                        dsadSADsadfSdf = false
                      } else {
                        bbbvcdfesDsADsaDSadFsdf =
                          DSADsADsadfSdf.id + '-' + DSADsaDsadfSdf.key.id
                      }
                      if (dsadSADsadfSdf) {
                        if (DSADsADsadfSdf.type == 1) {
                          if (
                            xcvxCVCxvdmN &&
                            DSADsaDsadfSdf != undefined &&
                            xcvxCVCxvdmN != undefined &&
                            xCvxCVCxvdmN.indexOf(xcvxCVCxvdmN.toLowerCase()) !==
                              -1
                          ) {
                            bbbvcdfesHnvvXnMNrrJuutyjty.send_auto_proccess(
                              DsADsaDsadfSdf,
                              HnVVxnMnrrjUutyjty,
                              xcVxcVCxvdmN,
                              dSADsaDsadfSdf,
                              'chatbot',
                              DSADsADsadfSdf,
                              DsadSADsadfSdf
                            )
                          }
                        } else {
                          bbbvcdfeshNVvxnMNrrJuutyjty.debug('Auto chatbot Ok 2')
                          for (
                            var XcvxCVCxvdmN = 0;
                            XcvxCVCxvdmN < xCvxCVCxvdmN.length;
                            XcvxCVCxvdmN++
                          ) {
                            if (DSADsaDsadfSdf != undefined && xcvxCVCxvdmN) {
                              var HnvvXNMnrrjUutyjty =
                                xcvxCVCxvdmN.toLowerCase()
                              if (
                                HnvvXNMnrrjUutyjty.indexOf(
                                  xCvxCVCxvdmN[XcvxCVCxvdmN]
                                ) !== -1
                              ) {
                                bbbvcdfesHnvvXnMNrrJuutyjty.send_auto_proccess(
                                  DsADsaDsadfSdf,
                                  HnVVxnMnrrjUutyjty,
                                  xcVxcVCxvdmN,
                                  dSADsaDsadfSdf,
                                  'chatbot',
                                  DSADsADsadfSdf,
                                  DsadSADsadfSdf
                                )
                              }
                            }
                          }
                        }
                      }
                    })
                  }
                }
              }
            )
          }
        }
      )
    }
  },
  send_auto_proccess: function (
    hNvvXNMnrrjUutyjty,
    dSadSADsadfSdf,
    HNvvXNMnrrjUutyjty,
    DSadSADsadfSdf,
    XCvxCVCxvdmN,
    hnVvXNMnrrjUutyjty,
    xcVxCVCxvdmN
  ) {
    var DsAdSADsadfSdf = JSON.parse(hnVvXNMnrrjUutyjty.media)
    switch (hnVvXNMnrrjUutyjty.cate) {
      case 2:
        var XcVxCVCxvdmN =
          "SELECT * from sp_whatsapp_template WHERE id = '" +
          hnVvXNMnrrjUutyjty.template +
          "'"
        bbbvcdfesxcvXcvCXvdMn.query(
          XcVxCVCxvdmN,
          function (hnVVXNMnrrjUutyjty, dsADSADsadfSdf) {
            if (dsADSADsadfSdf != undefined && dsADSADsadfSdf.length > 0) {
              dsADSADsadfSdf = dsADSADsadfSdf[0]
              var DsADSADsadfSdf = JSON.parse(dsADSADsadfSdf.data)
              hNvvXNMnrrjUutyjty
                .sendMessage(DSadSADsadfSdf, JSON.parse(dsADSADsadfSdf.data))
                .then((dSADSADsadfSdf) => {
                  if (XCvxCVCxvdmN == 'chatbot') {
                    bbbvcdfesHnvvXnMNrrJuutyjty.update_message_sent_per_day(
                      HNvvXNMnrrjUutyjty,
                      'chatbot',
                      dSadSADsadfSdf,
                      hnVvXNMnrrjUutyjty.id
                    )
                  } else {
                    bbbvcdfesHnvvXnMNrrJuutyjty.update_message_sent_per_day(
                      HNvvXNMnrrjUutyjty,
                      'autoresponder',
                      dSadSADsadfSdf,
                      false
                    )
                  }
                })
                .catch((hNVVXNMnrrjUutyjty) => {
                  bbbvcdfeshNVvxnMNrrJuutyjty.debug(hNVVXNMnrrjUutyjty)
                })
            }
          }
        )
        break
      case 3:
        var XcVxCVCxvdmN =
          "SELECT * from sp_whatsapp_template WHERE id = '" +
          hnVvXNMnrrjUutyjty.template +
          "'"
        bbbvcdfesxcvXcvCXvdMn.query(
          XcVxCVCxvdmN,
          function (XCVXCVCxvdmN, HNVVXNMnrrjUutyjty) {
            if (
              HNVVXNMnrrjUutyjty != undefined &&
              HNVVXNMnrrjUutyjty.length > 0
            ) {
              HNVVXNMnrrjUutyjty = HNVVXNMnrrjUutyjty[0]
              var DSADSADsadfSdf = JSON.parse(HNVVXNMnrrjUutyjty.data)
              hNvvXNMnrrjUutyjty
                .sendMessage(
                  DSadSADsadfSdf,
                  JSON.parse(HNVVXNMnrrjUutyjty.data)
                )
                .then((xcvxcvcXvdmN) => {
                  if (XCvxCVCxvdmN == 'chatbot') {
                    bbbvcdfesHnvvXnMNrrJuutyjty.update_message_sent_per_day(
                      HNvvXNMnrrjUutyjty,
                      'chatbot',
                      dSadSADsadfSdf,
                      hnVvXNMnrrjUutyjty.id
                    )
                  } else {
                    bbbvcdfesHnvvXnMNrrJuutyjty.update_message_sent_per_day(
                      HNvvXNMnrrjUutyjty,
                      'autoresponder',
                      dSadSADsadfSdf,
                      false
                    )
                  }
                })
                .catch((hnvvxnmNrrjUutyjty) => {
                  bbbvcdfeshNVvxnMNrrJuutyjty.debug(hnvvxnmNrrjUutyjty)
                })
            }
          }
        )
        break
      default:
        if (DsAdSADsadfSdf.length > 0) {
          var hNVvXNMnrrjUutyjty = hnVvXNMnrrjUutyjty.path
          var xCVxCVCxvdmN = DsAdSADsadfSdf[0].split('/assets/')
          xCVxCVCxvdmN = hNVvXNMnrrjUutyjty + '/assets/' + xCVxCVCxvdmN[1]
          var dSAdSADsadfSdf =
            bbbvcdfeshNVvxnMNrrJuutyjty.mimetype_from_extension(
              DsAdSADsadfSdf[0]
            )
          var XCVxCVCxvdmN = bbbvcdfeshNVvxnMNrrJuutyjty.post_type(
            dSAdSADsadfSdf,
            1
          )
          switch (XCVxCVCxvdmN) {
            case 'videoMessage':
              var DSAdSADsadfSdf = {
                video: bbbvcdfesxcvxcvCXvdMn.readFileSync(xCVxCVCxvdmN),
                caption: bbbvcdfesDSadsaDSadFsdf.unspin(xcVxCVCxvdmN),
              }
              break
            case 'imageMessage':
              var DSAdSADsadfSdf = {
                image: bbbvcdfesxcvxcvCXvdMn.readFileSync(xCVxCVCxvdmN),
                caption: bbbvcdfesDSadsaDSadFsdf.unspin(xcVxCVCxvdmN),
              }
              break
            case 'audioMessage':
              var DSAdSADsadfSdf = {
                audio: bbbvcdfesxcvxcvCXvdMn.readFileSync(xCVxCVCxvdmN),
              }
              break
            default:
              var DSAdSADsadfSdf = {
                document: bbbvcdfesxcvxcvCXvdMn.readFileSync(xCVxCVCxvdmN),
                fileName: filename,
                caption: bbbvcdfesDSadsaDSadFsdf.unspin(xcVxCVCxvdmN),
              }
              break
          }
          hNvvXNMnrrjUutyjty
            .sendMessage(DSadSADsadfSdf, DSAdSADsadfSdf)
            .then(async (dsadsadSadfSdf) => {
              if (XCvxCVCxvdmN == 'chatbot') {
                bbbvcdfesHnvvXnMNrrJuutyjty.update_message_sent_per_day(
                  HNvvXNMnrrjUutyjty,
                  'chatbot',
                  dSadSADsadfSdf,
                  hnVvXNMnrrjUutyjty.id
                )
              } else {
                bbbvcdfesHnvvXnMNrrJuutyjty.update_message_sent_per_day(
                  HNvvXNMnrrjUutyjty,
                  'autoresponder',
                  dSadSADsadfSdf,
                  false
                )
              }
            })
            .catch((DsadsadSadfSdf) => {
              bbbvcdfeshNVvxnMNrrJuutyjty.debug(DsadsadSadfSdf)
            })
        } else {
          hNvvXNMnrrjUutyjty
            .sendMessage(DSadSADsadfSdf, {
              text: bbbvcdfesDSadsaDSadFsdf.unspin(xcVxCVCxvdmN),
            })
            .then((HnvvxnmNrrjUutyjty) => {
              if (XCvxCVCxvdmN == 'chatbot') {
                bbbvcdfesHnvvXnMNrrJuutyjty.update_message_sent_per_day(
                  HNvvXNMnrrjUutyjty,
                  'chatbot',
                  dSadSADsadfSdf,
                  hnVvXNMnrrjUutyjty.id
                )
              } else {
                bbbvcdfesHnvvXnMNrrJuutyjty.update_message_sent_per_day(
                  HNvvXNMnrrjUutyjty,
                  'autoresponder',
                  dSadSADsadfSdf,
                  false
                )
              }
            })
            .catch((XcvxcvcXvdmN) => {
              bbbvcdfeshNVvxnMNrrJuutyjty.debug(XcvxcvcXvdmN)
            })
        }
    }
  },
  bulk_messaging: function () {
    if (
      bbbvcdfesxcvXcvCXvdMn.state != undefined &&
      bbbvcdfesxcvXcvCXvdMn.state == 'disconnected'
    ) {
      bbbvcdfesxcvXcvCXvdMn = bbbvcdfeshNVvxnMNrrJuutyjty.db_connect()
    }
    var dSadsadSadfSdf = Math.floor(new Date().getTime() / 1000)
    var XCvxcvcXvdmN =
      "\n\t\t\tSELECT a.*, b.category, b.login_type, b.name, b.username, b.token, b.avatar, b.url, b.data as account_data, b.ids as account_ids\n\t\t\tFROM sp_whatsapp_schedules as a\n\t\t\tJOIN sp_account_manager as b ON a.account_id = b.id\n\t\t\tWHERE a.status = 1 \n\t\t\tAND a.running = 0 \n\t\t\tAND  a.time_post <= '" +
      dSadsadSadfSdf +
      "'\n\t\t\tORDER BY a.time_post ASC\n\t\t \tLIMIT 5\n\t\t"
    bbbvcdfesxcvXcvCXvdMn.query(
      XCvxcvcXvdmN,
      function (DsaDsadSadfSdf, HnvVxnmNrrjUutyjty) {
        if (HnvVxnmNrrjUutyjty != undefined && HnvVxnmNrrjUutyjty.length > 0) {
          HnvVxnmNrrjUutyjty.forEach((HnvvXnmNrrjUutyjty) => {
            var dSadSadSadfSdf = { running: 1 }
            var hNvvXnmNrrjUutyjty = dSadSadSadfSdf
            var xCvxCvcXvdmN =
              "UPDATE sp_whatsapp_schedules SET ? WHERE id = '" +
              HnvvXnmNrrjUutyjty.id +
              "'"
            bbbvcdfesxcvXcvCXvdMn.query(
              xCvxCvcXvdmN,
              hNvvXnmNrrjUutyjty,
              function (XCvxCvcXvdmN, DSadSadSadfSdf) {}
            )
          })
          HnvVxnmNrrjUutyjty.forEach((HNvvXnmNrrjUutyjty) => {
            var hnVvXnmNrrjUutyjty = HNvvXnmNrrjUutyjty.id
            var dsAdSadSadfSdf = HNvvXnmNrrjUutyjty.ids
            var HnVvXnmNrrjUutyjty = HNvvXnmNrrjUutyjty.team_id
            var XcVxCvcXvdmN = HNvvXnmNrrjUutyjty.account_id
            var DsAdSadSadfSdf = HNvvXnmNrrjUutyjty.contact_group_id
            var hNVvXnmNrrjUutyjty = HNvvXnmNrrjUutyjty.name
            var dSAdSadSadfSdf = HNvvXnmNrrjUutyjty.cate
            var xCVxCvcXvdmN = HNvvXnmNrrjUutyjty.template
            var HNVvXnmNrrjUutyjty = HNvvXnmNrrjUutyjty.data
            var XCVxCvcXvdmN = JSON.parse(HNvvXnmNrrjUutyjty.media)
            var DSAdSadSadfSdf = HNvvXnmNrrjUutyjty.time_post
            var dsaDSadSadfSdf = HNvvXnmNrrjUutyjty.min_delay
            var hnvVXnmNrrjUutyjty = HNvvXnmNrrjUutyjty.max_delay
            var xcvXCvcXvdmN = HNvvXnmNrrjUutyjty.token
            var XcvXCvcXvdmN = HNvvXnmNrrjUutyjty.path
            var HnvVXnmNrrjUutyjty = HNvvXnmNrrjUutyjty.sent
            var DsaDSadSadfSdf = HNvvXnmNrrjUutyjty.failed
            var hNvVXnmNrrjUutyjty = JSON.parse(HNvvXnmNrrjUutyjty.result)
            var dSaDSadSadfSdf = HNvvXnmNrrjUutyjty.status
            var xCvXCvcXvdmN = HNvvXnmNrrjUutyjty.changed
            var HNvVXnmNrrjUutyjty = HNvvXnmNrrjUutyjty.created
            var DSaDSadSadfSdf = HNvvXnmNrrjUutyjty.username + '@c.us'
            var XCvXCvcXvdmN = HNvvXnmNrrjUutyjty.username + '@c.us'
            if (hNvVXnmNrrjUutyjty === null) {
              var dsADSadSadfSdf = ''
            } else {
              var dsADSadSadfSdf = [hNvVXnmNrrjUutyjty]
            }
            var hnVVXnmNrrjUutyjty =
              "\n\t\t\t\t\t\tSELECT * \n\t\t\t\t\t\tFROM sp_whatsapp_phone_numbers \n\t\t\t\t\t\tWHERE pid = '" +
              DsAdSadSadfSdf +
              "' \n\t\t\t\t\t\tAND phone NOT IN( ? )\n\t\t\t\t\t"
            bbbvcdfesxcvXcvCXvdMn.query(
              hnVVXnmNrrjUutyjty,
              dsADSadSadfSdf,
              function (hNvvxNmNrrjUutyjty, XCvxcVcXvdmN) {
                if (XCvxcVcXvdmN != undefined && XCvxcVcXvdmN.length > 0) {
                  var HNvvxNmNrrjUutyjty =
                    "SELECT * FROM sp_team WHERE id = '" +
                    HnVvXnmNrrjUutyjty +
                    "' "
                  bbbvcdfesxcvXcvCXvdMn.query(
                    HNvvxNmNrrjUutyjty,
                    function (hnVvxNmNrrjUutyjty, HnVvxNmNrrjUutyjty) {
                      if (
                        HnVvxNmNrrjUutyjty != undefined &&
                        HnVvxNmNrrjUutyjty.length > 0
                      ) {
                        var DsAdsAdSadfSdf =
                          "SELECT * FROM sp_whatsapp_stats WHERE team_id = '" +
                          HnVvxNmNrrjUutyjty[0].ids +
                          "'"
                        bbbvcdfesxcvXcvCXvdMn.query(
                          DsAdsAdSadfSdf,
                          function (XCvXcVcXvdmN, DSaDsAdSadfSdf) {
                            var hnVVxNmNrrjUutyjty =
                              XCvxcVcXvdmN[
                                Math.floor(Math.random() * XCvxcVcXvdmN.length)
                              ]
                            hnVVxNmNrrjUutyjty = hnVVxNmNrrjUutyjty.phone
                            var dsADsAdSadfSdf = hnVVxNmNrrjUutyjty + '@c.us'
                            bbbvcdfesHnvvXnMNrrJuutyjty.check_token(
                              HnVvxNmNrrjUutyjty[0].ids,
                              xcvXCvcXvdmN,
                              true,
                              false,
                              function (xcvxCVcXvdmN) {
                                if (xcvxCVcXvdmN) {
                                  bbbvcdfesHnvvXnMNrrJuutyjty.instance(
                                    xcvXCvcXvdmN,
                                    false,
                                    false,
                                    false,
                                    function (DsadSAdSadfSdf) {
                                      if (DsadSAdSadfSdf) {
                                        switch (dSAdSadSadfSdf) {
                                          case 2:
                                            var xCvxCVcXvdmN =
                                              "SELECT * from sp_whatsapp_template WHERE id = '" +
                                              xCVxCvcXvdmN +
                                              "'"
                                            bbbvcdfesxcvXcvCXvdMn.query(
                                              xCvxCVcXvdmN,
                                              function (
                                                hnVvXNmNrrjUutyjty,
                                                xcVxCVcXvdmN
                                              ) {
                                                xcVxCVcXvdmN = xcVxCVcXvdmN[0]
                                                var HnVvXNmNrrjUutyjty =
                                                  JSON.parse(xcVxCVcXvdmN.data)
                                                DsadSAdSadfSdf.sendMessage(
                                                  dsADsAdSadfSdf,
                                                  JSON.parse(xcVxCVcXvdmN.data)
                                                )
                                                  .then(
                                                    async (xCVxCVcXvdmN) => {
                                                      bbbvcdfesHnvvXnMNrrJuutyjty.update_message_sent_per_day(
                                                        HnVvxNmNrrjUutyjty[0]
                                                          .ids,
                                                        'bulk',
                                                        xcvXCvcXvdmN,
                                                        1
                                                      )
                                                      bbbvcdfesHnvvXnMNrrJuutyjty.bulk_message_stats(
                                                        HNvvXnmNrrjUutyjty,
                                                        DSaDsAdSadfSdf,
                                                        hNvVXnmNrrjUutyjty,
                                                        hnVVxNmNrrjUutyjty,
                                                        1,
                                                        0,
                                                        HnvVXnmNrrjUutyjty,
                                                        DsaDSadSadfSdf
                                                      )
                                                    }
                                                  )
                                                  .catch((dSAdSAdSadfSdf) => {
                                                    bbbvcdfesHnvvXnMNrrJuutyjty.update_message_sent_per_day(
                                                      HnVvxNmNrrjUutyjty[0].ids,
                                                      'bulk',
                                                      xcvXCvcXvdmN,
                                                      0
                                                    )
                                                    bbbvcdfesHnvvXnMNrrJuutyjty.bulk_message_stats(
                                                      HNvvXnmNrrjUutyjty,
                                                      DSaDsAdSadfSdf,
                                                      hNvVXnmNrrjUutyjty,
                                                      hnVVxNmNrrjUutyjty,
                                                      0,
                                                      1,
                                                      HnvVXnmNrrjUutyjty,
                                                      DsaDSadSadfSdf
                                                    )
                                                    bbbvcdfeshNVvxnMNrrJuutyjty.debug(
                                                      dSAdSAdSadfSdf
                                                    )
                                                  })
                                              }
                                            )
                                            break
                                          case 3:
                                            var xCvxCVcXvdmN =
                                              "SELECT * from sp_whatsapp_template WHERE id = '" +
                                              xCVxCvcXvdmN +
                                              "'"
                                            bbbvcdfesxcvXcvCXvdMn.query(
                                              xCvxCVcXvdmN,
                                              function (
                                                hNVvXNmNrrjUutyjty,
                                                HNVvXNmNrrjUutyjty
                                              ) {
                                                HNVvXNmNrrjUutyjty =
                                                  HNVvXNmNrrjUutyjty[0]
                                                var xcvXCVcXvdmN = JSON.parse(
                                                  HNVvXNmNrrjUutyjty.data
                                                )
                                                DsadSAdSadfSdf.sendMessage(
                                                  dsADsAdSadfSdf,
                                                  JSON.parse(
                                                    HNVvXNmNrrjUutyjty.data
                                                  )
                                                )
                                                  .then(
                                                    async (
                                                      hnvVXNmNrrjUutyjty
                                                    ) => {
                                                      bbbvcdfesHnvvXnMNrrJuutyjty.update_message_sent_per_day(
                                                        HnVvxNmNrrjUutyjty[0]
                                                          .ids,
                                                        'bulk',
                                                        xcvXCvcXvdmN,
                                                        1
                                                      )
                                                      bbbvcdfesHnvvXnMNrrJuutyjty.bulk_message_stats(
                                                        HNvvXnmNrrjUutyjty,
                                                        DSaDsAdSadfSdf,
                                                        hNvVXnmNrrjUutyjty,
                                                        hnVVxNmNrrjUutyjty,
                                                        1,
                                                        0,
                                                        HnvVXnmNrrjUutyjty,
                                                        DsaDSadSadfSdf
                                                      )
                                                    }
                                                  )
                                                  .catch((dsaDSAdSadfSdf) => {
                                                    bbbvcdfesHnvvXnMNrrJuutyjty.update_message_sent_per_day(
                                                      HnVvxNmNrrjUutyjty[0].ids,
                                                      'bulk',
                                                      xcvXCvcXvdmN,
                                                      0
                                                    )
                                                    bbbvcdfesHnvvXnMNrrJuutyjty.bulk_message_stats(
                                                      HNvvXnmNrrjUutyjty,
                                                      DSaDsAdSadfSdf,
                                                      hNvVXnmNrrjUutyjty,
                                                      hnVVxNmNrrjUutyjty,
                                                      0,
                                                      1,
                                                      HnvVXnmNrrjUutyjty,
                                                      DsaDSadSadfSdf
                                                    )
                                                    bbbvcdfeshNVvxnMNrrJuutyjty.debug(
                                                      dsaDSAdSadfSdf
                                                    )
                                                  })
                                              }
                                            )
                                            break
                                          default:
                                            if (XCVxCvcXvdmN.length > 0) {
                                              var XCvxCVcXvdmN =
                                                XCVxCvcXvdmN[0].split(
                                                  '/assets/'
                                                )
                                              XCvxCVcXvdmN =
                                                XcvXCvcXvdmN +
                                                '/assets/' +
                                                XCvxCVcXvdmN[1]
                                              var HNvvXNmNrrjUutyjty =
                                                bbbvcdfeshNVvxnMNrrJuutyjty.mimetype_from_extension(
                                                  XCVxCvcXvdmN[0]
                                                )
                                              var DSadSAdSadfSdf =
                                                bbbvcdfeshNVvxnMNrrJuutyjty.post_type(
                                                  HNvvXNmNrrjUutyjty,
                                                  1
                                                )
                                              switch (DSadSAdSadfSdf) {
                                                case 'videoMessage':
                                                  var dsAdSAdSadfSdf = {
                                                    video:
                                                      bbbvcdfesxcvxcvCXvdMn.readFileSync(
                                                        XCvxCVcXvdmN
                                                      ),
                                                    caption:
                                                      bbbvcdfesDSadsaDSadFsdf.unspin(
                                                        HNVvXnmNrrjUutyjty
                                                      ),
                                                  }
                                                  break
                                                case 'imageMessage':
                                                  var dsAdSAdSadfSdf = {
                                                    image:
                                                      bbbvcdfesxcvxcvCXvdMn.readFileSync(
                                                        XCvxCVcXvdmN
                                                      ),
                                                    caption:
                                                      bbbvcdfesDSadsaDSadFsdf.unspin(
                                                        HNVvXnmNrrjUutyjty
                                                      ),
                                                  }
                                                  break
                                                case 'audioMessage':
                                                  var dsAdSAdSadfSdf = {
                                                    audio:
                                                      bbbvcdfesxcvxcvCXvdMn.readFileSync(
                                                        XCvxCVcXvdmN
                                                      ),
                                                  }
                                                  break
                                                default:
                                                  var dsAdSAdSadfSdf = {
                                                    document:
                                                      bbbvcdfesxcvxcvCXvdMn.readFileSync(
                                                        XCvxCVcXvdmN
                                                      ),
                                                    fileName: filename,
                                                    caption:
                                                      bbbvcdfesDSadsaDSadFsdf.unspin(
                                                        HNVvXnmNrrjUutyjty
                                                      ),
                                                  }
                                                  break
                                              }
                                              DsadSAdSadfSdf.sendMessage(
                                                dsADsAdSadfSdf,
                                                dsAdSAdSadfSdf
                                              )
                                                .then(
                                                  async (DsaDSAdSadfSdf) => {
                                                    bbbvcdfesHnvvXnMNrrJuutyjty.update_message_sent_per_day(
                                                      HnVvxNmNrrjUutyjty[0].ids,
                                                      'bulk',
                                                      xcvXCvcXvdmN,
                                                      1
                                                    )
                                                    bbbvcdfesHnvvXnMNrrJuutyjty.bulk_message_stats(
                                                      HNvvXnmNrrjUutyjty,
                                                      DSaDsAdSadfSdf,
                                                      hNvVXnmNrrjUutyjty,
                                                      hnVVxNmNrrjUutyjty,
                                                      1,
                                                      0,
                                                      HnvVXnmNrrjUutyjty,
                                                      DsaDSadSadfSdf
                                                    )
                                                  }
                                                )
                                                .catch((XcvXCVcXvdmN) => {
                                                  bbbvcdfesHnvvXnMNrrJuutyjty.update_message_sent_per_day(
                                                    HnVvxNmNrrjUutyjty[0].ids,
                                                    'bulk',
                                                    xcvXCvcXvdmN,
                                                    0
                                                  )
                                                  bbbvcdfesHnvvXnMNrrJuutyjty.bulk_message_stats(
                                                    HNvvXnmNrrjUutyjty,
                                                    DSaDsAdSadfSdf,
                                                    hNvVXnmNrrjUutyjty,
                                                    hnVVxNmNrrjUutyjty,
                                                    0,
                                                    1,
                                                    HnvVXnmNrrjUutyjty,
                                                    DsaDSadSadfSdf
                                                  )
                                                  bbbvcdfeshNVvxnMNrrJuutyjty.debug(
                                                    XcvXCVcXvdmN
                                                  )
                                                })
                                            } else {
                                              DsadSAdSadfSdf.sendMessage(
                                                dsADsAdSadfSdf,
                                                {
                                                  text: bbbvcdfesDSadsaDSadFsdf.unspin(
                                                    HNVvXnmNrrjUutyjty
                                                  ),
                                                }
                                              )
                                                .then(
                                                  async (
                                                    HnvVXNmNrrjUutyjty
                                                  ) => {
                                                    bbbvcdfesHnvvXnMNrrJuutyjty.update_message_sent_per_day(
                                                      HnVvxNmNrrjUutyjty[0].ids,
                                                      'bulk',
                                                      xcvXCvcXvdmN,
                                                      1
                                                    )
                                                    bbbvcdfesHnvvXnMNrrJuutyjty.bulk_message_stats(
                                                      HNvvXnmNrrjUutyjty,
                                                      DSaDsAdSadfSdf,
                                                      hNvVXnmNrrjUutyjty,
                                                      hnVVxNmNrrjUutyjty,
                                                      1,
                                                      0,
                                                      HnvVXnmNrrjUutyjty,
                                                      DsaDSadSadfSdf
                                                    )
                                                  }
                                                )
                                                .catch((xCvXCVcXvdmN) => {
                                                  bbbvcdfesHnvvXnMNrrJuutyjty.update_message_sent_per_day(
                                                    HnVvxNmNrrjUutyjty[0].ids,
                                                    'bulk',
                                                    xcvXCvcXvdmN,
                                                    0
                                                  )
                                                  bbbvcdfesHnvvXnMNrrJuutyjty.bulk_message_stats(
                                                    HNvvXnmNrrjUutyjty,
                                                    DSaDsAdSadfSdf,
                                                    hNvVXnmNrrjUutyjty,
                                                    hnVVxNmNrrjUutyjty,
                                                    0,
                                                    1,
                                                    HnvVXnmNrrjUutyjty,
                                                    DsaDSadSadfSdf
                                                  )
                                                  bbbvcdfeshNVvxnMNrrJuutyjty.debug(
                                                    xCvXCVcXvdmN
                                                  )
                                                })
                                            }
                                            break
                                        }
                                      } else {
                                        bbbvcdfesHnvvXnMNrrJuutyjty.bulk_message_stats(
                                          HNvvXnmNrrjUutyjty,
                                          DSaDsAdSadfSdf,
                                          hNvVXnmNrrjUutyjty,
                                          hnVVxNmNrrjUutyjty,
                                          0,
                                          1,
                                          HnvVXnmNrrjUutyjty,
                                          DsaDSadSadfSdf
                                        )
                                      }
                                    }
                                  )
                                } else {
                                  bbbvcdfesHnvvXnMNrrJuutyjty.bulk_message_stats(
                                    HNvvXnmNrrjUutyjty,
                                    DSaDsAdSadfSdf,
                                    hNvVXnmNrrjUutyjty,
                                    hnVVxNmNrrjUutyjty,
                                    0,
                                    1,
                                    HnvVXnmNrrjUutyjty,
                                    DsaDSadSadfSdf
                                  )
                                }
                              }
                            )
                          }
                        )
                      } else {
                        var hNVvxNmNrrjUutyjty = {
                          running: 0,
                          status: 2,
                        }
                        var xCVxcVcXvdmN = hNVvxNmNrrjUutyjty
                        var dSAdsAdSadfSdf =
                          "UPDATE sp_whatsapp_schedules SET ? WHERE id = '" +
                          hnVvXnmNrrjUutyjty +
                          "'"
                        bbbvcdfesxcvXcvCXvdMn.query(
                          dSAdsAdSadfSdf,
                          xCVxcVcXvdmN,
                          function (dSaDSAdSadfSdf, hNvVXNmNrrjUutyjty) {}
                        )
                      }
                    }
                  )
                } else {
                  var DSadsAdSadfSdf = {
                    running: 0,
                    status: 2,
                  }
                  var xcVxcVcXvdmN = DSadsAdSadfSdf
                  var dsAdsAdSadfSdf =
                    "UPDATE sp_whatsapp_schedules SET ? WHERE id = '" +
                    hnVvXnmNrrjUutyjty +
                    "'"
                  bbbvcdfesxcvXcvCXvdMn.query(
                    dsAdsAdSadfSdf,
                    xcVxcVcXvdmN,
                    function (DSaDSAdSadfSdf, XCvXCVcXvdmN) {}
                  )
                }
              }
            )
          })
        }
      }
    )
  },
  bulk_message_stats: function (
    HNvVXNmNrrjUutyjty,
    xcVXCVcXvdmN,
    dsADSAdSadfSdf,
    hnVVXNmNrrjUutyjty,
    HnVVXNmNrrjUutyjty,
    XcVXCVcXvdmN,
    DsADSAdSadfSdf,
    xCVXCVcXvdmN
  ) {
    try {
      var DSadsaDSadfSdf = HNvVXNmNrrjUutyjty.id
      var dsadsaDSadfSdf = HNvVXNmNrrjUutyjty.contact_group_id
      var dSadsaDSadfSdf = HNvVXNmNrrjUutyjty.time_post
      var XcvxcvCXvdmN = HNvVXNmNrrjUutyjty.min_delay
      var HnvvxnMNrrjUutyjty = HNvVXNmNrrjUutyjty.max_delay
      var DsadsaDSadfSdf = Math.floor(new Date().getTime() / 1000)
      if (
        dsADSAdSadfSdf == undefined ||
        dsADSAdSadfSdf == '' ||
        dsADSAdSadfSdf.length == 0
      ) {
        var HNVVXNmNrrjUutyjty = [hnVVXNmNrrjUutyjty]
      } else {
        var HNVVXNmNrrjUutyjty = dsADSAdSadfSdf
        HNVVXNmNrrjUutyjty.push(hnVVXNmNrrjUutyjty)
      }
      var hNvvxnMNrrjUutyjty = DsADSAdSadfSdf + HnVVXNmNrrjUutyjty
      var hnvvxnMNrrjUutyjty = xCVXCVcXvdmN + XcVXCVcXvdmN
      var xCvxcvCXvdmN = hNvvxnMNrrjUutyjty + hnvvxnMNrrjUutyjty
      var XCvxcvCXvdmN =
        "SELECT count(*) as count FROM sp_whatsapp_phone_numbers WHERE pid = '" +
        dsadsaDSadfSdf +
        "'"
      bbbvcdfesxcvXcvCXvdMn.query(
        XCvxcvCXvdmN,
        function (hnvvXnMNrrjUutyjty, dsadSaDSadfSdf) {
          if (dsadSaDSadfSdf != undefined && dsadSaDSadfSdf.length > 0) {
            if (xCvxcvCXvdmN == dsadSaDSadfSdf[0].count) {
              var xcvxCvCXvdmN = {
                status: 2,
                running: 0,
              }
              var XcvxCvCXvdmN = xcvxCvCXvdmN
              var HnvvXnMNrrjUutyjty =
                "UPDATE sp_whatsapp_schedules SET ? WHERE id = '" +
                DSadsaDSadfSdf +
                "'"
              bbbvcdfesxcvXcvCXvdMn.query(
                HnvvXnMNrrjUutyjty,
                XcvxCvCXvdmN,
                function (DsadSaDSadfSdf, hNvvXnMNrrjUutyjty) {}
              )
            }
          }
        }
      )
      var HNvvxnMNrrjUutyjty =
        dSadsaDSadfSdf +
        (Math.floor(Math.random() * HnvvxnMNrrjUutyjty) + XcvxcvCXvdmN) *
          bbbvcdfeshNVvxnMNrrJuutyjty.run_by()
      if (HNvvxnMNrrjUutyjty < DsadsaDSadfSdf) {
        HNvvxnMNrrjUutyjty =
          DsadsaDSadfSdf +
          (Math.floor(Math.random() * HnvvxnMNrrjUutyjty) + XcvxcvCXvdmN) *
            bbbvcdfeshNVvxnMNrrJuutyjty.run_by()
      }
      var xcVxcvCXvdmN = {
        result: JSON.stringify(HNVVXNmNrrjUutyjty),
        sent: hNvvxnMNrrjUutyjty,
        failed: hnvvxnMNrrjUutyjty,
        time_post: HNvvxnMNrrjUutyjty,
        running: 0,
      }
      var xcvxcvCXvdmN =
        "UPDATE sp_whatsapp_schedules SET ? WHERE id = '" + DSadsaDSadfSdf + "'"
      bbbvcdfesxcvXcvCXvdMn.query(
        xcvxcvCXvdmN,
        xcVxcvCXvdmN,
        function (HNVVxnMNrrjUutyjty, DSADsaDSadfSdf) {}
      )
    } catch (dSadSaDSadfSdf) {
      bbbvcdfeshNVvxnMNrrJuutyjty.debug(dSadSaDSadfSdf)
      var hnVvxnMNrrjUutyjty = {
        running: 0,
        status: 1,
      }
      var xcVxcvCXvdmN = hnVvxnMNrrjUutyjty
      var xcvxcvCXvdmN =
        "UPDATE sp_whatsapp_schedules SET ? WHERE id = '" +
        HNvVXNmNrrjUutyjty.id +
        "'"
      bbbvcdfesxcvXcvCXvdMn.query(
        xcvxcvCXvdmN,
        xcVxcvCXvdmN,
        function (xCvxCvCXvdmN, HNvvXnMNrrjUutyjty) {}
      )
    }
  },
  check_live: function () {
    var XCvxCvCXvdmN =
      "\n\t\t\tSELECT *\n\t\t\tFROM sp_account_manager\n\t\t\tWHERE social_network = 'whatsapp' AND login_type = '2' AND status = 1\n\t\t\tORDER BY changed ASC\n\t\t\tLIMIT 1\n\t\t"
    bbbvcdfesxcvXcvCXvdMn.query(
      XCvxCvCXvdmN,
      async (XcvXCvCXvdmN, dSaDSaDSadfSdf) => {
        if (dSaDSaDSadfSdf != undefined && dSaDSaDSadfSdf.length > 0) {
          var dSaDSaDSadfSdf = dSaDSaDSadfSdf[0]
          var xCvXCvCXvdmN = dSaDSaDSadfSdf.token
          var HNvVXnMNrrjUutyjty =
            "SELECT * FROM sp_team WHERE id = '" + dSaDSaDSadfSdf.team_id + "' "
          bbbvcdfesxcvXcvCXvdMn.query(
            HNvVXnMNrrjUutyjty,
            function (DsADSaDSadfSdf, hNVVXnMNrrjUutyjty) {
              if (
                hNVVXnMNrrjUutyjty != undefined &&
                hNVVXnMNrrjUutyjty.length > 0
              ) {
                var hNVVXnMNrrjUutyjty = hNVVXnMNrrjUutyjty[0]
                var xCVXCvCXvdmN = hNVVXnMNrrjUutyjty.ids
                bbbvcdfesHnvvXnMNrrJuutyjty.check_token(
                  xCVXCvCXvdmN,
                  xCvXCvCXvdmN,
                  false,
                  false,
                  async (dSADSaDSadfSdf) => {
                    if (dSADSaDSadfSdf) {
                      var DSADSaDSadfSdf = {
                        changed: bbbvcdfeshNVvxnMNrrJuutyjty.now(),
                      }
                      var XCVXCvCXvdmN =
                        "UPDATE sp_account_manager SET ? WHERE id = '" +
                        dSaDSaDSadfSdf.id +
                        "'"
                      bbbvcdfesxcvXcvCXvdMn.query(
                        XCVXCvCXvdmN,
                        DSADSaDSadfSdf,
                        function (XcvxcVCXvdmN, DsadsADSadfSdf) {
                          bbbvcdfesHnvvXnMNrrJuutyjty.check_instance(
                            xCvXCvCXvdmN,
                            false,
                            false,
                            async (HnvvxNMNrrjUutyjty) => {
                              setTimeout(function () {
                                bbbvcdfesHnvvXnMNrrJuutyjty.check_live()
                              }, 5000)
                            }
                          )
                        }
                      )
                    } else {
                      bbbvcdfesHnvvXnMNrrJuutyjty.check_live()
                    }
                  }
                )
              }
            }
          )
        }
      }
    )
  },
  add_account: function (
    hNvvxNMNrrjUutyjty,
    dSadsADSadfSdf,
    xCvxcVCXvdmN,
    HNvvxNMNrrjUutyjty,
    XCvxcVCXvdmN
  ) {
    xCvxcVCXvdmN.jid = bbbvcdfeshNVvxnMNrrJuutyjty.get_phone(
      xCvxcVCXvdmN.id,
      'wid'
    )
    if (hNvvxNMNrrjUutyjty != undefined && hNvvxNMNrrjUutyjty.length == 0) {
      var DsAdsADSadfSdf = {
        ids: bbbvcdfesxCvxcvCXvdMn(bbbvcdfeshNVvxnMNrrJuutyjty.now()),
        social_network: 'whatsapp',
        category: 'profile',
        login_type: 2,
        can_post: 0,
        team_id: HNvvxNMNrrjUutyjty,
        pid: xCvxcVCXvdmN.jid,
        name: bbbvcdfeshNVvxnMNrrJuutyjty.get_phone(xCvxcVCXvdmN.id),
        username: xCvxcVCXvdmN.jid,
        token: dSadsADSadfSdf,
        avatar:
          xCvxcVCXvdmN.avatar != undefined &&
          xCvxcVCXvdmN.avatar &&
          xCvxcVCXvdmN.avatar != ''
            ? xCvxcVCXvdmN.avatar
            : 'https://ui-avatars.com/api?name=' +
              bbbvcdfeshNVvxnMNrrJuutyjty.get_phone(xCvxcVCXvdmN.id) +
              '&size=128&background=25D366&color=fff&format=png',
        url: 'https://web.whatsapp.com/',
        data: JSON.stringify(xCvxcVCXvdmN),
        status: 1,
        changed: bbbvcdfeshNVvxnMNrrJuutyjty.now(),
        created: bbbvcdfeshNVvxnMNrrJuutyjty.now(),
      }
      var hnVvxNMNrrjUutyjty = 'INSERT INTO sp_account_manager SET ?'
      bbbvcdfesxcvXcvCXvdMn.query(
        hnVvxNMNrrjUutyjty,
        DsAdsADSadfSdf,
        function (xCvXCVCXvdmN, hNvVXNMNrrjUutyjty) {}
      )
      var hnVvxNMNrrjUutyjty =
        "SELECT * FROM sp_team WHERE id = '" + HNvvxNMNrrjUutyjty + "'"
      bbbvcdfesxcvXcvCXvdMn.query(
        hnVvxNMNrrjUutyjty,
        function (dSaDSADSadfSdf, DSaDSADSadfSdf) {
          if (DSaDSADSadfSdf != undefined && DSaDSADSadfSdf.length > 0) {
            var XCvXCVCXvdmN =
              "SELECT * FROM sp_whatsapp_stats WHERE team_id = '" +
              DSaDSADSadfSdf[0].ids +
              "'"
            bbbvcdfesxcvXcvCXvdMn.query(
              XCvXCVCXvdmN,
              function (HNvVXNMNrrjUutyjty, xcVXCVCXvdmN) {
                if (DSaDSADSadfSdf != undefined && xcVXCVCXvdmN.length == 0) {
                  var hnVVXNMNrrjUutyjty = {
                    ids: bbbvcdfesxCvxcvCXvdMn(
                      bbbvcdfeshNVvxnMNrrJuutyjty.now()
                    ),
                    team_id: DSaDSADSadfSdf[0].ids,
                    wa_message_sent_today: 0,
                    wa_chat_count: 0,
                    wa_chatbot_count: 0,
                    wa_autoresponder_count: 0,
                    wa_bulk_total_count: 0,
                    wa_bulk_sent_count: 0,
                    wa_bulk_failed_count: 0,
                    wa_time_reset: 0,
                  }
                  var dsADSADSadfSdf = 'INSERT INTO sp_whatsapp_stats SET ?'
                  bbbvcdfesxcvXcvCXvdMn.query(
                    dsADSADSadfSdf,
                    hnVVXNMNrrjUutyjty,
                    function (HnVVXNMNrrjUutyjty, DsADSADSadfSdf) {}
                  )
                }
              }
            )
          }
        }
      )
    } else {
      var DsAdsADSadfSdf = {
        pid: xCvxcVCXvdmN.jid,
        name: bbbvcdfeshNVvxnMNrrJuutyjty.get_phone(xCvxcVCXvdmN.id),
        username: xCvxcVCXvdmN.jid,
        token: dSadsADSadfSdf,
        avatar:
          xCvxcVCXvdmN.avatar != undefined &&
          xCvxcVCXvdmN.avatar &&
          xCvxcVCXvdmN.avatar != ''
            ? xCvxcVCXvdmN.avatar
            : 'https://ui-avatars.com/api?name=' +
              bbbvcdfeshNVvxnMNrrJuutyjty.get_phone(xCvxcVCXvdmN.id) +
              '&size=128&background=25D366&color=fff&format=png',
        data: JSON.stringify(xCvxcVCXvdmN),
        status: 1,
        changed: bbbvcdfeshNVvxnMNrrJuutyjty.now(),
      }
      var xCVxcVCXvdmN =
        "UPDATE sp_account_manager SET ? WHERE id = '" +
        hNvvxNMNrrjUutyjty[0].id +
        "'"
      var dSAdsADSadfSdf = hNvvxNMNrrjUutyjty[0].token
      if (bbbvcdfesHnVVxnMNrrJuutyjty[dSAdsADSadfSdf]) {
        bbbvcdfesHnVVxnMNrrJuutyjty[dSAdsADSadfSdf].logout().then(async () => {
          var DsadsadsAdfSdf =
            __dirname + '/sessions/' + dSAdsADSadfSdf + '.json'
          try {
            if (bbbvcdfesxcvxcvCXvdMn.existsSync(DsadsadsAdfSdf)) {
              bbbvcdfesxcvxcvCXvdMn.unlinkSync(DsadsadsAdfSdf)
              delete bbbvcdfesXcVXcvCXvdMn[dSAdsADSadfSdf]
              delete bbbvcdfesHnVVxnMNrrJuutyjty[dSAdsADSadfSdf]
            }
          } catch (XcvxcvcxVdmN) {}
        })
      }
      if (XCvxcVCXvdmN) {
        var hnVvxNMNrrjUutyjty =
          "DELETE sp_whatsapp_sessions WHERE instance_id = '" +
          hNvvxNMNrrjUutyjty[0].token +
          "'"
        bbbvcdfesxcvXcvCXvdMn.query(
          hnVvxNMNrrjUutyjty,
          function (DSAdsadsAdfSdf, xcvXcvcxVdmN) {}
        )
      }
      var hnVvxNMNrrjUutyjty =
        "DELETE sp_whatsapp_sessions WHERE instance_id != '" +
        hNvvxNMNrrjUutyjty[0].token +
        "' AND status = 0"
      bbbvcdfesxcvXcvCXvdMn.query(
        hnVvxNMNrrjUutyjty,
        function (hnvvxnmnRrjUutyjty, dsadsadsAdfSdf) {}
      )
      var hnVvxNMNrrjUutyjty =
        "UPDATE sp_account_manager SET instance_id = '" +
        dSadsADSadfSdf +
        "' WHERE instance_id = '" +
        hNvvxNMNrrjUutyjty[0].token +
        "'"
      bbbvcdfesxcvXcvCXvdMn.query(
        hnVvxNMNrrjUutyjty,
        function (HNVVXNMNrrjUutyjty, xcvxcvcxVdmN) {}
      )
      var hnVvxNMNrrjUutyjty =
        "UPDATE sp_whatsapp_autoresponder SET instance_id = '" +
        dSadsADSadfSdf +
        "' WHERE instance_id = '" +
        hNvvxNMNrrjUutyjty[0].token +
        "'"
      bbbvcdfesxcvXcvCXvdMn.query(
        hnVvxNMNrrjUutyjty,
        function (xCVXCVCXvdmN, dSADSADSadfSdf) {}
      )
      var hnVvxNMNrrjUutyjty =
        "UPDATE sp_whatsapp_chatbot SET instance_id = '" +
        dSadsADSadfSdf +
        "' WHERE instance_id = '" +
        hNvvxNMNrrjUutyjty[0].token +
        "'"
      bbbvcdfesxcvXcvCXvdMn.query(
        hnVvxNMNrrjUutyjty,
        function (XCVxcvcxVdmN, HNVvxnmnRrjUutyjty) {}
      )
      var hnVvxNMNrrjUutyjty =
        "UPDATE sp_whatsapp_webhook SET instance_id = '" +
        dSadsADSadfSdf +
        "' WHERE instance_id = '" +
        hNvvxNMNrrjUutyjty[0].token +
        "'"
      bbbvcdfesxcvXcvCXvdMn.query(
        hnVvxNMNrrjUutyjty,
        function (XCVXCVCXvdmN, DSADSADSadfSdf) {}
      )
      bbbvcdfesxcvXcvCXvdMn.query(
        xCVxcVCXvdmN,
        DsAdsADSadfSdf,
        function (XcVXCVCXvdmN, hNVVXNMNrrjUutyjty) {}
      )
      var hnVvxNMNrrjUutyjty =
        "SELECT * FROM sp_team WHERE id = '" + HNvvxNMNrrjUutyjty + "'"
      bbbvcdfesxcvXcvCXvdMn.query(
        hnVvxNMNrrjUutyjty,
        function (HnvvxnmnRrjUutyjty, hNvvxnmnRrjUutyjty) {
          if (
            hNvvxnmnRrjUutyjty != undefined &&
            hNvvxnmnRrjUutyjty.length > 0
          ) {
            var xCvxcvcxVdmN =
              "SELECT * FROM sp_whatsapp_stats WHERE team_id = '" +
              hNvvxnmnRrjUutyjty[0].ids +
              "'"
            bbbvcdfesxcvXcvCXvdMn.query(
              xCvxcvcxVdmN,
              DsAdsADSadfSdf,
              function (HnVvxnmnRrjUutyjty, DsAdsadsAdfSdf) {
                if (
                  hNvvxnmnRrjUutyjty != undefined &&
                  DsAdsadsAdfSdf.length == 0
                ) {
                  var XcVxcvcxVdmN = {
                    ids: bbbvcdfesxCvxcvCXvdMn(
                      bbbvcdfeshNVvxnMNrrJuutyjty.now()
                    ),
                    team_id: hNvvxnmnRrjUutyjty[0].ids,
                    wa_message_sent_today: 0,
                    wa_chat_count: 0,
                    wa_chatbot_count: 0,
                    wa_autoresponder_count: 0,
                    wa_bulk_total_count: 0,
                    wa_bulk_sent_count: 0,
                    wa_bulk_failed_count: 0,
                    wa_time_reset: 0,
                  }
                  var hNVvxnmnRrjUutyjty = 'INSERT INTO sp_whatsapp_stats SET ?'
                  bbbvcdfesxcvXcvCXvdMn.query(
                    hNVvxnmnRrjUutyjty,
                    XcVxcvcxVdmN,
                    function (dSAdsadsAdfSdf, xCVxcvcxVdmN) {}
                  )
                }
              }
            )
          }
        }
      )
    }
  },
}
module.exports = bbbvcdfesHnvvXnMNrrJuutyjty
setInterval(function () {
  bbbvcdfesHnvvXnMNrrJuutyjty.bulk_messaging()
}, 5000)
setTimeout(function () {
  bbbvcdfesHnvvXnMNrrJuutyjty.check_live()
}, 2000)
